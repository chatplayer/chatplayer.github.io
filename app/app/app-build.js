"bundle";!function(){var a=System.amdDefine;a("app.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="partials/nav-bar"></require><require from="pages/chat"></require><div id="chat-sidebar" class="sidebar-wrapper"><div class="sidebar-page-content"><nav-bar router.bind="router"></nav-bar><div class="page-host"><router-view></router-view></div></div><chat id="chat" class="sidebar"></chat></div></template>'})}(),System.register("app.js",["aurelia-framework","aurelia-authentication","services/settings","configs/platform"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.inject},function(a){e=a.AuthenticateStep},function(a){f=a.Settings},function(a){g=a.platform}],execute:function(){a("App",(h=d(f),j=h(i=function(){function a(b){c(this,a),this.settings=b}return a.prototype.configureRouter=function(a,b){a.title="ChatPlayer",g.web&&a.addPipelineStep("authorize",e),a.map([{route:"",redirect:g.web?"weblib":"library"},{route:"login",name:"login",moduleId:"pages/fullscreen-login",title:"Login"},{route:"library",name:"library",moduleId:g.web?"pages/library-fake":"pages/library",nav:!0,title:"ChatPlayer Local"},{route:"weblib/:artist?/:artist_gid?/:song?/:song_gid?",name:"weblib",moduleId:"pages/weblib",nav:!0,title:"ChatPlayer Web",href:"#/weblib",auth:!0}]),this.router=b},a}())||i)),a("App",j)}}}),System.register("blur-image.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b,c,d,f,g){if(!(isNaN(g)||g<1)){g|=0;var h,i=a.getContext("2d");try{h=i.getImageData(b,c,d,f)}catch(a){throw new Error("unable to access image data: "+a)}var j,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=h.data,K=g+g+1,L=d-1,M=f-1,N=g+1,O=N*(N+1)/2,P=new e,Q=P;for(n=1;n<K;n++)if(Q=Q.next=new e,n==N)var R=Q;Q.next=P;var S=null,T=null;r=q=0;var U=k[g],V=l[g];for(m=0;m<f;m++){for(A=B=C=D=s=t=u=v=0,w=N*(E=J[q]),x=N*(F=J[q+1]),y=N*(G=J[q+2]),z=N*(H=J[q+3]),s+=O*E,t+=O*F,u+=O*G,v+=O*H,Q=P,n=0;n<N;n++)Q.r=E,Q.g=F,Q.b=G,Q.a=H,Q=Q.next;for(n=1;n<N;n++)o=q+((L<n?L:n)<<2),s+=(Q.r=E=J[o])*(I=N-n),t+=(Q.g=F=J[o+1])*I,u+=(Q.b=G=J[o+2])*I,v+=(Q.a=H=J[o+3])*I,A+=E,B+=F,C+=G,D+=H,Q=Q.next;for(S=P,T=R,j=0;j<d;j++)J[q+3]=H=v*U>>V,0!=H?(H=255/H,J[q]=(s*U>>V)*H,J[q+1]=(t*U>>V)*H,J[q+2]=(u*U>>V)*H):J[q]=J[q+1]=J[q+2]=0,s-=w,t-=x,u-=y,v-=z,w-=S.r,x-=S.g,y-=S.b,z-=S.a,o=r+((o=j+g+1)<L?o:L)<<2,A+=S.r=J[o],B+=S.g=J[o+1],C+=S.b=J[o+2],D+=S.a=J[o+3],s+=A,t+=B,u+=C,v+=D,S=S.next,w+=E=T.r,x+=F=T.g,y+=G=T.b,z+=H=T.a,A-=E,B-=F,C-=G,D-=H,T=T.next,q+=4;r+=d}for(j=0;j<d;j++){for(B=C=D=A=t=u=v=s=0,q=j<<2,w=N*(E=J[q]),x=N*(F=J[q+1]),y=N*(G=J[q+2]),z=N*(H=J[q+3]),s+=O*E,t+=O*F,u+=O*G,v+=O*H,Q=P,n=0;n<N;n++)Q.r=E,Q.g=F,Q.b=G,Q.a=H,Q=Q.next;for(p=d,n=1;n<=g;n++)q=p+j<<2,s+=(Q.r=E=J[q])*(I=N-n),t+=(Q.g=F=J[q+1])*I,u+=(Q.b=G=J[q+2])*I,v+=(Q.a=H=J[q+3])*I,A+=E,B+=F,C+=G,D+=H,Q=Q.next,n<M&&(p+=d);for(q=j,S=P,T=R,m=0;m<f;m++)o=q<<2,J[o+3]=H=v*U>>V,H>0?(H=255/H,J[o]=(s*U>>V)*H,J[o+1]=(t*U>>V)*H,J[o+2]=(u*U>>V)*H):J[o]=J[o+1]=J[o+2]=0,s-=w,t-=x,u-=y,v-=z,w-=S.r,x-=S.g,y-=S.b,z-=S.a,o=j+((o=m+N)<M?o:M)*d<<2,s+=A+=S.r=J[o],t+=B+=S.g=J[o+1],u+=C+=S.b=J[o+2],v+=D+=S.a=J[o+3],S=S.next,w+=E=T.r,x+=F=T.g,y+=G=T.b,z+=H=T.a,A-=E,B-=F,C-=G,D-=H,T=T.next,q+=d}i.putImageData(h,b,c)}}function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function f(a,b){var c=a.width,e=a.height,f=a.getContext("2d");f.drawImage(b,0,0,c,e),d(a,0,0,c,e,m)}var g,h,i,j,k,l,m;return{setters:[function(a){g=a.inject}],execute:function(){a("BlurImageCustomAttribute",(h=g(Element),j=h(i=function(){function a(b){c(this,a),this.element=b}return a.prototype.valueChanged=function(a){var b=this;a.complete?f(this.element,a):a.onload=function(){return f(b.element,a)}},a}())||i)),a("BlurImageCustomAttribute",j),k=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],l=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],m=40}}}),System.register("customattributes/enter-press.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.customAttribute,e=a.inject}],execute:function(){a("EnterPress",(f=d("enter-press"),g=e(Element),i=f(h=g(h=function(){function a(b){var d=this;c(this,a),this.element=b,this.enterPressed=function(a){var b=a.which||a.keyCode;13===b&&d.value()}}return a.prototype.attached=function(){this.element.addEventListener("keypress",this.enterPressed)},a.prototype.detached=function(){this.element.removeEventListener("keypress",this.enterPressed)},a}())||h)||h)),a("EnterPress",i)}}}),System.register("customattributes/infinite-scroll.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s;return{setters:[function(a){f=a.inject,g=a.bindable,h=a.customAttribute,i=a.DOM}],execute:function(){a("InfiniteScrollCustomAttribute",(j=h("infinite-scroll"),k=f(i.Element),s=j(l=k((r=q=function(){function a(b){var e=this;d(this,a),this.isTicking=!1,c(this,"callback",n,this),c(this,"scrollBuffer",o,this),c(this,"isActive",p,this),this.onScrollChange=function(){return!!e.isActive&&(e.isTicking||window.requestAnimationFrame(function(){e.checkScrollPosition(),e.isTicking=!1}),void(e.isTicking=!0))},this.element=b}return a.prototype.attached=function(){this.element.scrollTop=this.element.scrollHeight,this.element.addEventListener(a.ScrollEventName,this.onScrollChange),this.onScrollChange()},a.prototype.detached=function(){this.element.removeEventListener(a.ScrollEventName,this.onScrollChange)},a.prototype.callbackChanged=function(a){this.callback=a},a.prototype.scrollBufferChanged=function(a){this.scrollBuffer=+a},a.prototype.isActiveChanged=function(a){this.isActive="true"===a},a.prototype.checkScrollPosition=function(){var a=this.element.scrollTop,b=this.element.scrollHeight-this.element.offsetHeight;this.callback&&0!=b&&a===b&&this.callback()},a}(),q.ScrollEventName="scroll",m=r,n=e(m.prototype,"callback",[g],{enumerable:!0,initializer:null}),o=e(m.prototype,"scrollBuffer",[g],{enumerable:!0,initializer:function(){return 10}}),p=e(m.prototype,"isActive",[g],{enumerable:!0,initializer:function(){return!0}}),l=m))||l)||l)),a("InfiniteScrollCustomAttribute",s)}}}),System.register("customattributes/open-in-browser.js",["aurelia-framework","../configs/platform"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.customAttribute,e=a.inject},function(a){f=a.platform}],execute:function(){a("OpenInBrowser",(g=d("open-in-browser"),h=e(Element),j=g(i=h(i=function(){function a(b){var d=this;c(this,a),this.element=b,this.onClick=function(a){if(f.electron){var b=require("electron"),c=b.shell;c.openExternal(d.value)}else window.open(d.value,"_blank");a.preventDefault()}}return a.prototype.attached=function(){this.element.addEventListener("click",this.onClick)},a.prototype.detached=function(){this.element.removeEventListener("click",this.onClick)},a}())||i)||i)),a("OpenInBrowser",j)}}}),System.register("customattributes/popover.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){f=a.customAttribute,g=a.inject,h=a.bindable}],execute:function(){a("Popover",(i=f("popover"),j=g(Element),o=i(k=j((l=function(){function a(b){d(this,a),c(this,"title",m,this),c(this,"content",n,this),this.dynamicContent=null,this.popoverObject=null,this.element=b}return a.prototype.contentChanged=function(a,b){a&&a.name&&(this.dynamicContent=a.name)},a.prototype.attached=function(){var a=this;$(this.element).popover({title:this.title,content:this.content,trigger:"manual",html:!0}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)}).on("shown.bs.popover",function(b){$(".popover-content")[0].innerHTML=a.dynamicContent})},a.prototype.detached=function(){$(this.element).popover("destroy")},a}(),m=e(l.prototype,"title",[h],{enumerable:!0,initializer:null}),n=e(l.prototype,"content",[h],{enumerable:!0,initializer:null}),k=l))||k)||k)),a("Popover",o)}}}),System.register("customattributes/sidebar-toggle.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){f=a.customAttribute,g=a.inject,h=a.bindable}],execute:function(){a("SidebarToggle",(i=f("sidebar-toggle"),j=g(Element),o=i(k=j((l=function(){function a(b){var e=this;d(this,a),c(this,"target",m,this),c(this,"opened",n,this),this.element=b,this.toggleClass=function(a){e.sidebarWrapperElement.classList.toggle("opened"),a.preventDefault()}}return a.prototype.attached=function(){this.sidebarWrapperElement=document.getElementById(this.target),1==this.opened?this.sidebarWrapperElement.classList.add("opened"):this.sidebarWrapperElement.classList.remove("opened"),this.element.addEventListener("click",this.toggleClass)},a.prototype.detached=function(){this.element.removeEventListener("click",this.toggleClass)},a}(),m=e(l.prototype,"target",[h],{enumerable:!0,initializer:null}),n=e(l.prototype,"opened",[h],{enumerable:!0,initializer:null}),k=l))||k)||k)),a("SidebarToggle",o)}}}),System.register("customattributes/yt-player.js",["aurelia-framework","aurelia-event-aggregator"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l;return{setters:[function(a){d=a.inject,e=a.customAttribute,g=a.LogManager},function(a){f=a.EventAggregator}],execute:function(){a("YTPlayer",(h=d(Element,f),i=e("yt-player"),k=h(j=i(j=function(){function a(b,d){c(this,a),this.quality="default",this.height="100%",this.width="100%",this.params={enablejsapi:0,autoplay:0,showinfo:0,controls:0},this.duration=0,this.waitingInterval=!0,this.element=b,this.eventAggregator=d,this.logger=g.getLogger("yt-player"),this.getScript(),this.logger.debug("Plugin loaded")}return a.prototype.getScript=function(){if("undefined"==typeof YT||"undefined"==typeof YT.Player){window.onYouTubeIframeAPIReady=this.loadPlayer.bind(this);var a={publisher:this,data:"https://www.youtube.com/iframe_api"};this.eventAggregator.publish("ytplayer:init:getScript",a),this.logger.debug("Plugin init getScript")}else this.loadPlayer()},a.prototype.valueChanged=function(a){var b=this;this.videoId=a,1!=this.waitingInterval||this.playerAPI?this.loadAndPlayVideo():this.waitingInterval=setInterval(function(){return b.waitingForPlayerAndPlay()},1e3)},a.prototype.waitingForPlayerAndPlay=function(){this.playerAPI?(clearInterval(this.waitingInterval),this.loadAndPlayVideo(),this.logger.debug("ready...")):this.logger.debug("waiting...")},a.prototype.loadPlayer=function(){this.player=new YT.Player(this.element,{height:this.height,width:this.width,playerVars:this.params,events:{onReady:this.onPlayerReady.bind(this),onStateChange:this.onPlayerStateChange.bind(this),onError:this.onError.bind(this)}}),this.logger.debug("Player object created")},a.prototype.onPlayerReady=function(a){this.logger.debug("Player ready"),this.playerAPI=new l(this.player,this.element,this.logger),this.eventAggregator.publish("ytplayer:load:player",this.playerAPI)},a.prototype.loadAndPlayVideo=function(){this.videoId&&this.validVideoId(this.videoId)?(this.player.cueVideoById(this.videoId,this.quality),this.eventAggregator.publish("ytplayer:load:video",this.playerAPI),this.logger.debug("Loaded video: "+this.videoId),this.player.playVideo()):this.logger.error("Missing or Invalid video ID: "+this.videoId)},a.prototype.onPlayerStateChange=function(a){switch(a.data){case YT.PlayerState.CUED:this.eventAggregator.publish("ytplayer:state:cued",this.playerAPI);break;case YT.PlayerState.ENDED:this.eventAggregator.publish("ytplayer:state:ended",this.playerAPI);break;case YT.PlayerState.PLAYING:this.eventAggregator.publish("ytplayer:state:playing",this.playerAPI);break;case YT.PlayerState.PAUSED:this.eventAggregator.publish("ytplayer:state:paused",this.playerAPI);break;case YT.PlayerState.BUFFERING:this.eventAggregator.publish("ytplayer:state:buffering",this.playerAPI);break;default:this.eventAggregator.publish("ytplayer:state:unstarted",this.playerAPI)}},a.prototype.onError=function(a){switch(a.data){case 2:this.eventAggregator.publish("ytplayer:error:invalid-param",this.playerAPI);break;case 5:this.eventAggregator.publish("ytplayer:error:html5",this.playerAPI);break;case 100:this.eventAggregator.publish("ytplayer:error:not-found",this.playerAPI);break;case 101:case 150:this.eventAggregator.publish("ytplayer:error:access-denied",this.playerAPI);break;default:this.eventAggregator.publish("ytplayer:error:unknown",this.playerAPI)}this.eventAggregator.publish("ytplayer:error",this.playerAPI),this.logger.error("YT error: "+a.data)},a.prototype.validVideoId=function(a){return 11===a.length},a}())||j)||j)),a("YTPlayer",k),l=function(){function a(b,d,e){c(this,a),this.YtPlayerAPI=!0,this.player=b,this.element=d,this.logger=e}return a.prototype.play=function(){this.player.playVideo?this.player.playVideo():this.logger.warn("Unable to play video")},a.prototype.pause=function(){this.player.pauseVideo?this.player.pauseVideo():this.logger.warn("Unable to pause video")},a.prototype.stop=function(){this.player.stopVideo?this.player.stopVideo():this.logger.warn("Unable to stop video")},a.prototype.setSeekBar=function(a){this.player.playVideo||this.player.pauseVideo?this.player.seekTo(a):this.logger.warn("Unable to play video")},a.prototype.setVolume=function(a){this.player.setVolume(100*a)},a.prototype.getVideoId=function(){var a=this.player.getPlaylist(),b="";return a.lenght>0&&(b=a[this.player.getPlaylistIndex()]),b},a.prototype.getCurrentTime=function(){return this.player.getCurrentTime()},a.prototype.getDuration=function(){return this.player.getDuration()},a.prototype.getContainer=function(){return this.element},a}()}}}),function(){var a=System.amdDefine;a("customelements/html5-player.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><audio><source if.bind="playSource" src.bind="playSource" type="audio/ogg"><source if.bind="playSource" src.bind="playSource" type="audio/mpeg"></audio></template>'})}(),System.register("customelements/html5-player.js",["aurelia-framework","aurelia-event-aggregator"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p;return{setters:[function(a){f=a.bindable,g=a.inject,h=a.customElement},function(a){i=a.EventAggregator}],execute:function(){a("Html5Player",(j=g(Element,i),k=h("html5-player"),o=j(l=k((m=function(){function a(b,e){var f=this;d(this,a),c(this,"source",n,this),this.element=b,this.ea=e,this.handlePlayerEnded=function(){f.ea.publish("html5player:state:ended")}}return a.prototype.attached=function(){this.html5Audio=this.element.querySelector("audio"),this.html5PlayerAPI=new p(this.html5Audio),this.ea.publish("html5player:load:player",this.html5PlayerAPI),this.html5Audio.addEventListener("ended",this.handlePlayerEnded)},a.prototype.detached=function(){this.html5Audio.removeEventListener("ended",this.handlePlayerEnded)},a.prototype.sourceChanged=function(a){this.playSource=a,this.html5Audio.load(),this.html5Audio.play()},a}(),n=e(m.prototype,"source",[f],{enumerable:!0,initializer:null}),l=m))||l)||l)),a("Html5Player",o),p=function(){function a(b){d(this,a),this.Html5PlayerAPI=!0,this.player=b}return a.prototype.play=function(){this.player.play()},a.prototype.pause=function(){this.player.pause()},a.prototype.stop=function(){this.player.pause(),this.player.currentTime=0},a.prototype.setSeekBar=function(a){this.player.currentTime=a},a.prototype.setVolume=function(a){this.player.volume=a},a.prototype.getCurrentTime=function(){return this.player.currentTime},a.prototype.getDuration=function(){return this.player.duration},a}()}}}),function(){var a=System.amdDefine;a("customelements/msg-content.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><compose view.bind="viewStrategy" containerless></compose></template>'})}(),System.register("customelements/msg-content.js",["aurelia-framework","../configs/chat"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m;return{setters:[function(a){f=a.bindable,g=a.bindingMode,h=a.InlineViewStrategy},function(a){i=a.configChat}],execute:function(){a("MsgContent",(j=f({defaultBindingMode:g.oneWay}),k=function(){function a(){d(this,a),c(this,"content",l,this)}return a.prototype.attached=function(){this.render()},a.prototype.replacer=function(a,b,c,d,e,f){if(a.indexOf(i.client)>=0){var g=a.split("weblib/");g=g[g.length-1].split("/");var h=decodeURIComponent(g[0]),j=decodeURIComponent(g[2]),k="undefined"===j?h:h+" - "+j;return"<a href.bind=\"'"+new URL(a).hash+'\'"><i class="fa fa-play"></i> '+k+"</a>"}return'<require from="customattributes/open-in-browser"></require><a open-in-browser.bind="\''+a+'\'" href="#"><i class="fa fa-external-link-square"></i> '+a+"</a>"},a.prototype.render=function(){var a=this.content.replace(/(http|https):\/\/[\w-]+(\.[\w-]+)*([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/gm,this.replacer);this.viewStrategy=new h("<template>"+a+"</template>")},a}(),l=e(k.prototype,"content",[j],{enumerable:!0,initializer:null}),m=k)),a("MsgContent",m)}}}),function(){var a=System.amdDefine;a("customelements/player-controls.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customattributes/yt-player"></require><require from="customelements/html5-player"></require><html5-player source.bind="localPath"></html5-player><div show.bind="youtubeId" class="fixed-yt-player ${chatOpened == 1 ? \'\' : \'move-right\'}"><div yt-player="${youtubeId}"></div></div><div class="player-controls"><div class="pl-controls-wrapper"><div class="pl-controls"><div class="backward" click.delegate="playPrev()"></div><div class="play-track"></div><div class="forward" click.delegate="playNext()"></div></div></div><div class="seek-bar-wrapper"><input type="range" class="seek-bar" min="0" value="0"></div><div class="volume-up"></div><div class="volume-bar-wrapper"><input type="range" min="0" max="1" step="0.05" value="1" class="volume-bar"></div></div></template>'})}(),System.register("customelements/player-controls.js",["aurelia-framework","aurelia-event-aggregator","../events/player","../events/room","../utility"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){f=a.customElement,g=a.bindable,h=a.inject,i=a.observable,k=a.LogManager},function(a){j=a.EventAggregator},function(a){l=a.PlayerPlay,m=a.PlayerNext,n=a.PlayerPrev},function(a){o=a.RoomFind},function(a){p=a.areEqual}],execute:function(){a("PlayerControls",(q=h(Element,j,k),w=q((s=function(){function a(b,e,f){var g=this;d(this,a),c(this,"currentPlayer",t,this),c(this,"chat",u,this),c(this,"chatOpened",v,this),this.youtubeId=null,this.localPath=null,this.html5player=null,this.ytPlayerApi=null,this.currentPlayer=null,this.element=b,this.ea=e,this.logger=k.getLogger("player-controls"),this.ea.subscribe("ytplayer:init:getScript",function(a){$.getScript(a.data)}),this.ea.subscribe("ytplayer:load:player",function(a){g.ytPlayerApi=a,g.currentPlayer=g.ytPlayerApi,g.logger.debug("yt player loaded"),g.logger.debug(a)}),this.ea.subscribe("html5player:load:player",function(a){g.html5Player=a,g.logger.debug("html5 player loaded")}),this.ea.subscribe("ytplayer:state:ended",function(a){g.playNext()}),this.ea.subscribe("html5player:state:ended",function(a){g.playNext()}),e.subscribe(l,function(a){g.playButton.classList.add("pause"),a.localPath?(g.currentPlayer=g.html5Player,g.localPath=a.localPath,g.youtubeId=null):a.youtubeId&&(g.currentPlayer=g.ytPlayerApi,g.youtubeId=a.youtubeId),g.ea.publish(new o(a))}),this.handlePlayerEnded=function(){g.playNext()},this.onClickPlayButton=function(){var a=g.playButton.classList.toggle("pause");a?g.currentPlayer.play():g.currentPlayer.pause()},this.onChangeSeekBar=function(){var a=g.currentPlayer.getDuration()*(g.seekBar.value/100);g.currentPlayer.setSeekBar(a)}}return a.prototype.attached=function(){var a=this;this.playButton=this.element.querySelector(".play-track"),this.seekBar=this.element.querySelector(".seek-bar"),this.volumeBar=this.element.querySelector(".volume-bar"),this.playButton.addEventListener("click",this.onClickPlayButton),this.seekBar.addEventListener("change",this.onChangeSeekBar),this.seekBar.addEventListener("mousedown",function(){a.seekBarMouseDown=!0,a.currentPlayer.pause()}),this.seekBar.addEventListener("mouseup",function(){a.seekBarMouseDown=!1,a.currentPlayer.play()}),this.volumeBar.addEventListener("change",function(){a.currentPlayer.setVolume(a.volumeBar.value)}),this.updateSeekBarInterval=setInterval(function(){return a._updateSeekBarValue()},1e3)},a.prototype.detached=function(){this.playButton.removeEventListener("click",this.onClickPlayButton),this.seekBar.removeEventListener("change",this.onChangeSeekBar),clearInterval(this.updateSeekBarInterval)},a.prototype.currentPlayerChanged=function(a,b){a&&b&&!p(a,b)&&b.stop()},a.prototype._updateSeekBarValue=function(){if(this.currentPlayer&&1!=this.seekBarMouseDown){var a=100/this.currentPlayer.getDuration()*this.currentPlayer.getCurrentTime();this.seekBar.value=a}},a.prototype.playing=function(){},a.prototype.playPrev=function(){this.ea.publish(new n(this.currentPlayer))},a.prototype.playNext=function(){this.ea.publish(new m(this.currentPlayer))},a}(),t=e(s.prototype,"currentPlayer",[i],{enumerable:!0,initializer:null}),u=e(s.prototype,"chat",[g],{enumerable:!0,initializer:null}),v=e(s.prototype,"chatOpened",[g],{enumerable:!0,initializer:null}),r=s))||r)),a("PlayerControls",w)}}}),function(){var a=System.amdDefine;a("customelements/user-label.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><span class="dropdown"><a id="dLabel" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="${user.avatar}"></a><ul if.bind="withMenu" class="dropdown-menu" aria-labelledby="dLabel"><li><img src="${user.avatar}"><a href="#">${user.name}</a></li><li><a href="#">some profile info</a></li><li if.bind="chat.currentUserId && user && chat.currentUserId != user.id"><a class="btn" href="#" click.delegate="favoriteUser(user)">star</a></li><li if.bind="chat.currentUserId && user && chat.currentUserId != user.id"><a class="btn" href="#" if.bind="!chat.followChannel.followUserId" click.delegate="chat.followNow(user)">Follow now</a> <a class="btn" href="#" if.bind="chat.followChannel.followUserId == user.id" click.delegate="chat.unfollowAllNow()">Unfollow</a></li><li if.bind="chat.currentUserId && user && chat.currentUserId != user.id"><a class="btn" href="#" click.delegate="privateChatRequestFor(user)">private chat</a></li></ul></span></template>'})}(),System.register("customelements/user-label.js",["aurelia-framework","services/http-client-with-auth","aurelia-event-aggregator","events/user"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return{setters:[function(a){f=a.bindable,g=a.inject,h=a.customElement,i=a.bindingMode},function(a){j=a.HttpClientWithAuth},function(a){k=a.EventAggregator},function(a){l=a.UserEnterPrivateRoom}],execute:function(){a("UserLabel",(m=g(Element,j,k),n=h("user-label"),t=m(o=n((p=function(){function a(b,e,f){d(this,a),c(this,"chat",q,this),c(this,"user",r,this),c(this,"withMenu",s,this),this.element=b,this.http=e,this.ea=f}return a.prototype.favoriteUser=function(a){this.http.fetch("users/"+a.id+"/favorite",{method:"post"}).then(function(a){return a.json()}).then(function(a){})},a.prototype.privateChatRequestFor=function(a){var b=this;this.http.fetch("users/"+a.id+"/private_chat_request",{method:"post"}).then(function(a){return a.json()}).then(function(a){b.ea.publish(new l(a))})},a}(),q=e(p.prototype,"chat",[f],{enumerable:!0,initializer:null}),r=e(p.prototype,"user",[f],{enumerable:!0,initializer:null}),s=e(p.prototype,"withMenu",[f],{enumerable:!0,initializer:function(){return!1}}),o=p))||o)||o)),a("UserLabel",t)}}}),System.register("electron.js",[],function(a,b){"use strict";return{setters:[],execute:function(){}}}),System.register("configs/auth.js",["./environment","./chat"],function(a,b){"use strict";var c,d,e,f,g,h;return{setters:[function(a){c=a.env},function(a){d=a.configChat}],execute:function(){g={baseUrl:d.host,loginUrl:"users/sign_in.json",signupUrl:"users.json",profileUrl:"users/me.json",loginOnSignup:!1,loginRedirect:"",signupRedirect:""},e={providers:{google:{redirectUri:d.client,clientId:"1072345495355-ofh05sa6ui841oojmbv73lffge2d29ue.apps.googleusercontent.com"},facebook:{redirectUri:d.client,clientId:"1389790321051342"}}},f={providers:{google:{redirectUri:d.client,clientId:"1072345495355-ofh05sa6ui841oojmbv73lffge2d29ue.apps.googleusercontent.com"},facebook:{redirectUri:d.client,clientId:"1389790321051342"}}},g=Object.assign(g,"development"===c?e:f),a("configAuth",h=g),a("configAuth",h)}}}),System.register("main.js",["jquery","bootstrap-sass","configs/auth","configs/chat","configs/environment","services/http-client-json"],function(a,b){"use strict";function c(a){"production"!=g&&a.use.developmentLogging(),a.container.registerInstance("GoogleClient",new h("https://www.googleapis.com")),a.container.registerInstance("SearchClient",new h(f.search_host)),
a.use.standardConfiguration().plugin("aurelia-validation").plugin("aurelia-ui-virtualization").plugin("aurelia-authentication",function(a){a.configure(e)}),a.use.plugin("aurelia-animator-css"),a.start().then(function(){return a.setRoot()})}var d,e,f,g,h;return a("configure",c),{setters:[function(a){d=a.default},function(a){},function(a){e=a.configAuth},function(a){f=a.configChat},function(a){g=a.env},function(a){h=a.HttpClientJson}],execute:function(){}}}),function(){var a=System.amdDefine;a("pages/chat.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="pages/room"></require><require from="pages/private-room"></require><require from="partials/follow-notify"></require><require from="partials/private-message-notify"></require><require from="partials/signup"></require><require from="partials/login"></require><require from="partials/forgot"></require><require from="partials/user-profile"></require><require from="pages/favorites"></require><require from="pages/private-chats"></require><div if.bind="!isAuthenticated" class="${platform.web ? \'fullscreen-overlay\': \'\'}"><div if.bind="!isAuthenticated && platform.web" class="hero-login text-center"><div class="logo"><img src="imgs/logo.png"></div><h1>ChatPlayer</h1><h3>You need to log in before continuing <i style="margin-left:1rem" class="fa fa-angle-right"></i></h3></div><signup if.bind="chat.router.signup || chat.router.confirmAccount || chat.router.signupSuccess" chat.bind="chat" class="chat-overlay"></signup><login if.bind="chat.router.login" chat.bind="chat" class="chat-overlay"></login><forgot if.bind="chat.router.forgot || chat.router.forgotSent" chat.bind="chat" class="chat-overlay"></forgot></div><div if.bind="isAuthenticated"><compose if.bind="chat.router.faq" view="partials/faq.html" chat.bind="chat" class="chat-overlay"></compose><follow-notify chat.bind="chat"></follow-notify><private-message-notify chat.bind="chat"></private-message-notify><favorites if.bind="chat.router.favs" chat.bind="chat" class="chat-overlay"></favorites><private-chats if.bind="chat.router.privateChats" chat.bind="chat" class="chat-overlay"></private-chats><user-profile if.bind="chat.router.userProfile" chat.bind="chat" class="chat-overlay"></user-profile><private-room chat.bind="chat"></private-room></div><room chat.bind="chat"></room></template>'})}(),System.register("services/users-channel.js",["aurelia-framework","services/cable","aurelia-authentication","services/http-client-with-auth","aurelia-event-aggregator","events/user"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n;return{setters:[function(a){d=a.inject,e=a.LogManager},function(a){f=a.Websocket},function(a){g=a.AuthService},function(a){h=a.HttpClientWithAuth},function(a){i=a.EventAggregator},function(a){j=a.UserEnterPrivateRoom,k=a.UserPrivateMessageNotify}],execute:function(){a("UsersChannel",(l=d(f,g,i,h),n=l(m=function(){function a(b,d,f,g){var h=this;c(this,a),this.userSubscription=null,this.userSubscriptionCallback={connected:function(){h.logger.debug("Connected: "+h.userSubscription.identifier)},received:function(a){h.logger.debug("Received: "),h.logger.debug(a),a.private_invitation&&h.ea.publish(new j(a.private_invitation)),a.private_message&&h.ea.publish(new k(a.private_message,a.user))}},this.ws=b,this.auth=d,this.ea=f,this.http=g,this.logger=e.getLogger("users-channel"),this.ea.subscribe("authentication-change",function(a){a?h.subscribeToChannel():h.unsubscribeFromChannel()}),this.subscribeToChannel()}return a.prototype.subscribeToChannel=function(){this.auth.authenticated&&!this.userSubscription&&(this.userSubscription=this.ws.getConsumer().subscriptions.create({channel:"UsersChannel",token:this.auth.authentication.getAccessToken(),id:this.auth.authentication.getResponseObject().id},this.userSubscriptionCallback))},a.prototype.unsubscribeFromChannel=function(){this.userSubscription&&(this.ws.getConsumer().subscriptions.remove(this.userSubscription),this.userSubscription=null)},a}())||m)),a("UsersChannel",n)}}}),System.register("services/follows-channel.js",["aurelia-framework","services/cable","aurelia-authentication","services/http-client-with-auth","aurelia-event-aggregator","events/user"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n;return{setters:[function(a){d=a.inject,e=a.LogManager},function(a){f=a.Websocket},function(a){g=a.AuthService},function(a){h=a.HttpClientWithAuth},function(a){i=a.EventAggregator},function(a){j=a.UserFollowNotify,k=a.UserEnterPrivateRoom}],execute:function(){a("FollowsChannel",(l=d(f,g,i,h),n=l(m=function(){function a(b,d,f,g){var h=this;c(this,a),this.followUserSubscription=null,this.followUserId=null,this.userFollowSubscriptionCallback={connected:function(){h.logger.debug("Connected to follow user: "+h.followUserSubscription.identifier),h.followUserId=JSON.parse(h.followUserSubscription.identifier).id},received:function(a){h.logger.debug("Received from follow: "),h.logger.debug(a),a.enter_room&&a.user&&null!=h.followUserId&&h.ea.publish(new j(a.enter_room,a.user))},unfollow:function(){h.followUserSubscription.perform("unfollow")},unsubscribe:function(){h.logger.debug("Unsubscribed follow: "+h.followUserSubscription.identifier),h.followUserSubscription=null,h.followUserId=null},disconnected:function(){h.logger.debug("Disconnected follow: "+h.followUserSubscription.identifier)}},this.ws=b,this.auth=d,this.ea=f,this.http=g,this.logger=e.getLogger("follows-channel"),this.auth.getMe().then(function(a){a.following_id&&h.subscribeToUserFollowChannel({id:a.following_id})})}return a.prototype.subscribeToUserFollowChannel=function(a){a&&!this.followUserSubscription&&(this.followUserSubscription=this.ws.getConsumer().subscriptions.create({channel:"UsersChannel",token:this.auth.authentication.getAccessToken(),id:a.id},this.userFollowSubscriptionCallback))},a.prototype.unsubscribeFromUserFollowChannel=function(){this.followUserSubscription&&(this.followUserSubscription.unfollow(),this.ws.getConsumer().subscriptions.remove(this.followUserSubscription),this.followUserSubscription.unsubscribe())},a}())||m)),a("FollowsChannel",n)}}}),System.register("pages/chat.js",["aurelia-framework","services/cable","aurelia-authentication","configs/platform","aurelia-event-aggregator","events/user","services/user-service","services/users-channel","services/follows-channel"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){e=a.inject,f=a.computedFrom},function(a){g=a.Websocket},function(a){h=a.AuthService},function(a){i=a.platform},function(a){j=a.EventAggregator},function(a){k=a.UserEnterPrivateRoom},function(a){l=a.UserService},function(a){m=a.UsersChannel},function(a){n=a.FollowsChannel}],execute:function(){o=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Chat",(p=e(g,h,j,l,m,n),q=f("userService.id"),r=f("userService.name"),s=f("userService.avatar"),t=f("auth.authenticated"),w=p((v=function(){function a(b,d,e,f,g,h){var j=this;c(this,a),this.router={signup:!1,login:!1,confirmAccount:!1,signupSuccess:!1,faq:!1,forgot:!1,forgotSent:!1,favs:!1,userProfile:!1,privateRoom:!1,privateChats:!1},this.chat=this,this.ws=b,this.ws.getConsumer(),this.auth=d,this.platform=i,this.ea=e,this.userService=f,this.userChannel=g,this.followChannel=h,i.web&&this.show("login"),this.ea.subscribe("authentication-change",function(a){i.web&&!a&&j.show("login")}),this.ea.subscribe(k,function(a){j.show("privateRoom")})}return a.prototype.show=function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.hideAll(),this.router[a]=b},a.prototype.hideAll=function(){var a=this;Object.keys(this.router).forEach(function(b){a.router[b]=!1})},a.prototype.followNow=function(a){this.followChannel.subscribeToUserFollowChannel(a)},a.prototype.unfollowAllNow=function(){this.followChannel.unsubscribeFromUserFollowChannel()},a.prototype.privateChatRequest=function(a){},o(a,[{key:"currentUserId",get:function(){return this.userService.id}},{key:"currentUserName",get:function(){return this.userService.name}},{key:"currentUserAvatar",get:function(){return this.userService.avatar}},{key:"isAuthenticated",get:function(){return this.auth.authenticated}},{key:"connectionOpen",get:function(){return!this.ws.getConsumer().connection.disconnected}}]),a}(),d(v.prototype,"currentUserId",[q],Object.getOwnPropertyDescriptor(v.prototype,"currentUserId"),v.prototype),d(v.prototype,"currentUserName",[r],Object.getOwnPropertyDescriptor(v.prototype,"currentUserName"),v.prototype),d(v.prototype,"currentUserAvatar",[s],Object.getOwnPropertyDescriptor(v.prototype,"currentUserAvatar"),v.prototype),d(v.prototype,"isAuthenticated",[t],Object.getOwnPropertyDescriptor(v.prototype,"isAuthenticated"),v.prototype),u=v))||u)),a("Chat",w)}}}),function(){var a=System.amdDefine;a("pages/favorites.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="overlay-table"><div class="overlay-navbar"><a class="close" click.delegate="chat.hideAll()" href="#">&times;</a><div class="overlay-header"><div class="overlay-title">Your favorite chatters</div></div></div><div class="overlay-precontent"><div class="precontent-inner"><div class="text-center"><div class="btn-group"><button type="button" class="btn btn-primary active">You starred</button> <button type="button" class="btn btn-default">Starred you</button></div></div></div></div><div class="overlay-content"><div class="content-inner"><div repeat.for="user of favorites" class="media user-label medium"><div class="media-left media-middle"><a href="#"><img class="media-object" src="${user.avatar}" title="${user.name}"></a></div><div class="media-body"><h4 class="media-heading">${user.name}</h4><a href="#" if.bind="!chat.followChannel.followUserId" click.delegate="chat.followNow(user)">Follow now</a> <a href="#" if.bind="chat.followChannel.followUserId == user.id" click.delegate="chat.unfollowAllNow()">Unfollow</a></div><div if.bind="chat.followChannel.followUserId != user.id" class="media-right media-middle"><a href="#" click.delegate="unfavoriteUser(user)" class="fa fa-close fa-2x"></a></div></div></div></div></div></template>'})}(),System.register("pages/favorites.js",["aurelia-framework","aurelia-fetch-client","services/http-client-with-auth"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.json},function(a){i=a.HttpClientWithAuth}],execute:function(){a("Favorites",(j=f(i),n=j((l=function(){function a(b){d(this,a),c(this,"chat",m,this),this.favorites=[],this.http=b}return a.prototype.attached=function(){var a=this;this.http.fetch("users/favoriting").then(function(a){return a.json()}).then(function(b){a.favorites=b})},a.prototype.unfavoriteUser=function(a){var b=this;this.http.fetch("users/"+a.id+"/unfavorite",{method:"post"}).then(function(){var c=b.favorites.findIndex(function(b){return b.id==a.id});b.favorites.splice(c,1)})},a}(),m=e(l.prototype,"chat",[g],{enumerable:!0,initializer:null}),k=l))||k)),a("Favorites",n)}}}),function(){var a=System.amdDefine;a("pages/fullscreen-login.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return"<template></template>"})}(),System.register("pages/fullscreen-login.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j;return{setters:[function(a){f=a.inject,g=a.bindable}],execute:function(){a("FullscreenLogin",(h=function a(){d(this,a),c(this,"chat",i,this)},i=e(h.prototype,"chat",[g],{enumerable:!0,initializer:null}),j=h)),a("FullscreenLogin",j)}}}),function(){var a=System.amdDefine;a("pages/library-fake.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customattributes/open-in-browser"></require><div class="subpage-content container-fluid text-center"><h1 class="text-muted">Get ChatPlayer for desktop</h1><h2 class="text-muted">Listen music from your local drive</h2><br><br><a class="btn-lg btn-primary" open-in-browser="https://chatplayer.github.io/#download" href="#">Download</a></div></template>'})}(),System.register("pages/library-fake.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("LibraryFake",d=function a(){c(this,a)}),a("LibraryFake",d)}}}),function(){var a=System.amdDefine;a("pages/library.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="valueconverters/properties"></require><require from="valueconverters/date-format"></require><require from="customattributes/infinite-scroll"></require><nav class="navbar navbar-default subpage-navbar"><ul class="nav navbar-nav"><li><form class="navbar-form"><span class="label label-primary">${files.length}<span if.bind="selectedFilesCount"> / ${selectedFilesCount}</span></span> <span class="btn btn-primary btn-file ${importing ? \'disabled\' : \'\'}" title="Add music from local drive"><i class="fa fa-upload ${importing ? \'fa-circle-o-notch fa-spin\' : \'\'}"></i> &nbsp; Add from local drive <input type="file" webkitdirectory multiple="multiple" change.delegate="selectedDir($event)"></span></form></li><li><a if.bind="importing" style="padding-left:0;color:#a94442" class="fa fa-remove" href="#" click.delegate="cancelImport()" title="Cancel adding"></a></li></ul><ul class="nav navbar-nav"><li><a if.bind="!importing" class="fa fa-trash-o" click.delegate="clearPlaylist()" title="Remove all from library" href="#"></a></li><li><a class="fa fa-2x fa-search" href="#"></a></li></ul><ul class="nav nav-justified"><li><form class="navbar-form"><input type="text" value.bind="searchPhrase & debounce:250" class="form-control search-input" placeholder="Search local library..." autofocus></form></li></ul></nav><div class="subpage-content container-fluid"><h1 if.bind="files.length == 0" class="text-muted text-center">No items in library</h1><div if.bind="files.length > 0" class="div-table-row head"><div class="col-xs-1">#</div><div class="col-xs-3">Track</div><div class="col-xs-3">Artist</div><div class="col-xs-3">Album</div><div class="col-xs-2"><i class="fa fa-clock-o"></i></div></div><div class="div-table absolute"><div virtual-repeat.for="file of files | filterOnProperties:\'artist,album,song\':searchPhrase" click.delegate="playPath(file)" class="div-table-row ${file._id === selectedId ? \'active\' : \'\'}"><div class="col-xs-1">${file.no}</div><div class="col-xs-3 toverflow" title="${file.song}">${file.song}</div><div class="col-xs-3 toverflow" title="${file.artist}">${file.artist}</div><div class="col-xs-3 toverflow" title="${file.album}">${file.album}</div><div class="col-xs-2">${file.dur * 1000 | dateFormat: \'m:ss\'}</div></div></div></div></template>'})}(),System.register("pages/library.js",["aurelia-framework","aurelia-event-aggregator","../events/player","aurelia-fetch-client","fetch","fs","node-dir","nedb-promise","musicmetadata"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return{setters:[function(a){d=a.inject,e=a.singleton},function(a){f=a.EventAggregator},function(a){g=a.PlayerPlay,h=a.PlayerNext,i=a.PlayerPrev},function(a){j=a.HttpClient},function(a){},function(a){k=a.default},function(a){l=a.default},function(a){m=a.default},function(a){n=a.default}],execute:function(){o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a("Library",(p=e(),q=d(j,l,m({filename:"library.db",autoload:!0}),f),s=p(r=q(r=function(){function a(b,d,e,f){var g=this;c(this,a),this.files=[],this.filesCount=0,this.selectedId=null,this.selectedFilesCount=null,this.importing=!1,this.importCanceled=!1,this.fspath=d,this.db=e,this.ea=f,f.subscribe(h,function(a){a.html5Player&&g.playNext()}),f.subscribe(i,function(a){a.html5Player&&g.playPrev()}),this.db.ccount().exec().then(function(a){g.filesCount=a}),this.db.cfind({}).sort({artist:1,album:1,disk:1,no:1}).exec().then(function(a){g.files=a})}return a.prototype.addMore=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,c=this.files.length;console.debug("more skip: "+c+" limit: "+b),this.db.cfind({}).sort({artist:1,album:1,disk:1,no:1}).skip(c).limit(b).exec().then(function(b){b.map(function(b){a.files.push(b)})})},a.prototype.getFilePaths=function(a){var b=this;return new Promise(function(c,d){b.fspath.paths(a,function(a,b){a&&d(a),c(b)})})},a.prototype.getFileId3=function(a){return new Promise(function(b,c){var d=k.statSync(a).size,e=k.createReadStream(a);n(e,{duration:!1,fileSize:d},function(a,d){e.destroy(),a&&c(a),b(d)})})},a.prototype.getFileCover=function(a){var b=this;return this.getFileId3(a.path).then(function(c){for(var d=0;d<b.files.length;d++)if(b.files[d]._id===a._id){c.picture.length>0&&(b.files[d].cover="data: image/"+c.picture[0].format+";base64,"+c.picture[0].data.toString("base64"));break}}),!0},a.prototype.getFileId3AndInsert=function(a){var b=this;return this.getFileId3(a).then(function(c){return b.db.update({path:a},{path:a,artist:c.artist,album:c.album,song:c.title,dur:c.duration,no:c.track.no,disk:c.disk.no},{upsert:!0})}).catch(function(b){console.debug("error: "+b+" in "+a)})},a.prototype.selectedDir=function(a){var b=this;return!(a.target.files.length<=0)&&(1!=this.importing&&(this.importing=!0,void this.getFilePaths(a.target.files[0].path).then(function(a){return a.files.filter(function(a){return/\.(?:wav|mp3|ogg|oga|aac)$/i.test(a)})}).then(function(a){b.selectedFilesCount=a.length,Promise.map(a,function(a){if(b.importCanceled)throw"Import canceled";return b.getFileId3AndInsert(a).then(function(a){if("object"==("undefined"==typeof a?"undefined":o(a))){var c=a[1];b.files.push(c)}})},{concurrency:1}).then(function(){b.importing=!1,b.selectedFilesCount=null}).catch(function(a){console.debug("error: "+a),b.importing=!1,b.importCanceled=!1,b.selectedFilesCount=null})})))},a.prototype.cancelImport=function(){var a=confirm("Are you sure you wish to cancel adding music to player library?");return!!a&&void(this.importCanceled=!0)},a.prototype.clearPlaylist=function(){var a=this,b=confirm("Are you sure you wish to clear player library?");return!!b&&void this.db.remove({},{multi:!0}).then(function(b){a.files.splice(0,a.files.length)})},a.prototype.playPath=function(a){this.ea.publish(new g(a)),this.selectedId=a._id},a.prototype.playNext=function(){for(var a=0;a<this.files.length;a++)if(this.files[a]._id===this.selectedId){this.selectedId=this.files[a+1]._id,this.playPath(this.files[a+1]);break}},a.prototype.playPrev=function(){for(var a=0;a<this.files.length;a++)if(this.files[a]._id===this.selectedId){this.selectedId=this.files[a-1]._id,this.playPath(this.files[a-1]);break}},a}())||r)||r)),a("Library",s)}}}),function(){var a=System.amdDefine;a("pages/private-chats.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="overlay-table"><div class="overlay-navbar"><a class="close" click.delegate="chat.hideAll()" href="#">&times;</a><div class="overlay-header"><div class="overlay-title">Your private chats</div></div></div><div class="overlay-precontent"><div class="precontent-inner"><div class="text-center"><div class="btn-group"><button type="button" class="btn btn-primary active">accepted</button> <button type="button" class="btn btn-default">waiting</button></div></div></div></div><div class="overlay-content"><div class="content-inner"><div repeat.for="pchat of prchats" class="media user-label medium" click.delegate="enterPrivateRoom(pchat)"><div class="media-left media-middle"><!-- <a href="#" if.bind="proom.invited.id != chat.currentUserId"> --> <img class="media-object" src="${pchat.user.avatar}" title="${pchat.user.name}"><!-- </a> --><!-- <a href="#" if.bind="proom.inviter.id != chat.currentUserId"> --><!-- <img class="media-object" src="${proom.inviter.avatar}" title="${proom.inviter.name}" /> --><!-- </a> --></div><div class="media-body"><h4 class="media-heading">${pchat.user.name}</h4></div><div class="media-right media-middle"><a href="#" class="fa fa-close fa-2x"></a></div></div></div></div></div></template>'})}(),System.register("pages/private-chats.js",["aurelia-framework","aurelia-fetch-client","services/http-client-with-auth","aurelia-event-aggregator","../events/user"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.json},function(a){i=a.HttpClientWithAuth},function(a){j=a.EventAggregator},function(a){k=a.UserEnterPrivateRoom}],execute:function(){a("PrivateChats",(l=f(i,j),p=l((n=function(){function a(b,e){d(this,a),c(this,"chat",o,this),this.prchats=[],this.http=b,this.ea=e}return a.prototype.attached=function(){var a=this;this.http.fetch("users/private_chats").then(function(a){return a.json()}).then(function(b){a.prchats=b.list_chats})},a.prototype.enterPrivateRoom=function(a){this.ea.publish(new k(a))},a}(),o=e(n.prototype,"chat",[g],{enumerable:!0,initializer:null}),m=n))||m)),a("PrivateChats",p)}}}),function(){var a=System.amdDefine;a("pages/private-room.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customelements/msg-content"></require><require from="customelements/user-label"></require><require from="customattributes/enter-press"></require><require from="customattributes/open-in-browser"></require><require from="valueconverters/date-from"></require><require from="valueconverters/take"></require><div if.bind="chat.router.privateRoom" class="chat-overlay"><div class="overlay-table"><div class="overlay-navbar"><a class="close" click.delegate="closePrivateChat()" href="#">&times;</a><div class="overlay-header"><div class="overlay-title">Private chat</div></div></div><!-- <div if.bind="!room.accepted" class="overlay-content">\n        <div class="padding-content valign-wrapper">\n          <div class="valign">\n            <div if.bind="room.inviter.id == chat.currentUserId" class="text-muted text-center">\n              <p>${room.inviter.name} would like to start private chat with you</p>\n              <a href="#" class="user-label large">\n                <img src="${room.invited.avatar}" />\n              </a>\n              <h4 class="text-muted">${room.invited.name}</h4>\n            </div>\n\n            <div if.bind="room.invited.id == chat.currentUserId" class="text-muted text-center">\n              <p>${room.inviter.name} would like to start private chat with you</p>\n              <a href="#" class="user-label large">\n                <img src="${room.inviter.avatar}" />\n              </a>\n              <h4 class="text-muted">${room.inviter.name}</h4>\n            </div>\n\n            <div if.bind="room.invited.id == chat.currentUserId" class="text-center">\n              <h4 class="text-muted">waiting for your confirmation</h4>\n\n              <button type="button" class="btn btn-default">Decline</button>\n              <button type="button" class="btn btn-primary" click.delegate="acceptPrivateChat()">Accept</button>\n            </div>\n\n            <h4 if.bind="room.inviter.id == chat.currentUserId" class="text-muted">\n              Waiting for ${room.invited.name} confirmation\n            </h4>\n          </div>\n        </div>\n      </div> --><h4 if.bind="msgs.length > 0 && !room.accepted && room.inviter.id == chat.currentUserId" class="text-muted">Wait for ${room.invited.name} response</h4><h4 class="text-muted text-center" if.bind="msgs.length <= 0">No one said a word here.<br>What about you?</h4><!-- <div  class="overlay-content"> --><div class="msgs"><div class="msgs-inner" ref="container"><div repeat.for="msg of msgs" class="msg ${grouped = msg.user.id != msgs[$index-1].user.id ? \'grouped\':null} ${lastingroup = msg.user.id != msgs[$index+1].user.id ? \'lastingroup\':\'\'}"><div class="user-label ${!grouped ? \'dis\':\'\'}"><img if.bind="grouped" class="media-object" src="${msg.user.avatar}"></div><div class="msg-body"><div class="msg-head" if.bind="grouped">${msg.user.name}</div><msg-content content.bind="msg.content"></msg-content><small if.bind="lastingroup" class="created-at">${msg.created_at | dateFrom: currentTime}</small></div></div></div></div><div class="send-message"><div class="send-message-inner"><input type="text" placeholder="Type to talk" class="form-control" value.bind="currentMsg" keyup.delegate="sendMessage($event)"></div></div><!-- </div> --></div></div></template>'})}(),System.register("pages/private-room.js",["aurelia-framework","aurelia-event-aggregator","../events/user","../services/cable","../services/settings","aurelia-authentication","../utility","fetch","moment"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return{setters:[function(a){f=a.observable,g=a.inject,h=a.bindable,i=a.LogManager},function(a){j=a.EventAggregator},function(a){k=a.UserEnterPrivateRoom},function(a){l=a.Websocket},function(a){m=a.Settings},function(a){n=a.AuthService},function(a){o=a.areEqual},function(a){},function(a){p=a.default}],execute:function(){a("PrivateRoom",(q=g(n,j,l,m),u=q((s=function(){function a(b,e,f,g){var h=this;d(this,a),c(this,"chat",t,this),this.msgs=[],this.users=[],this.room=null,this.currentMsg=null,this.showLogin=!0,this.showSignup=!0,this.roomType=1,this.roomDataForType=null,this.rateLimitReset=!1,this.rateLimitResetCount=0,this.currentTime=p(),this.chatVisible=!0,this.lastScrollHeight=0,this.roomSubscriptionCallback={connected:function(){h.logger.debug("AC Connected: "+h.roomSubscription.identifier),h.roomSubscription.login({token:h.auth.authentication.getAccessToken()}),h.roomSubscription.room_data()},disconnected:function(){h.logger.debug("AC Disconnected: "+h.roomSubscription.identifier)},received:function(a){if(a.room_data&&(h.room=a.room_data),a.user_enter){h.logger.debug("AC Receive: user_enter");var b=h.users.findIndex(function(b){return b.id==a.user_enter.id});b===-1&&(h.users.push(a.user_enter),h.users.length>1&&!h.chatVisible&&h.userEnterAudio.play())}if(a.user_leave){var c=h.users.findIndex(function(b){return b.id==a.user_leave.id});h.users.splice(c,1)}a.list_msgs&&(h.logger.debug("AC Receive: list_msgs"),h.msgs=a.list_msgs,h.scrollContainerToBottom()),a.list_users&&(h.logger.debug("AC Receive: list_users"),h.users=a.list_users),a.content&&(h.msgs.push(a),h.scrollContainerToBottom(100),h.chatVisible||h.newMessageAudio.play()),a.rate_limit_reset&&(h.rateLimitResetCount=a.rate_limit_reset,h.rateLimitReset||(h.rateLimitReset=!0,setTimeout(function(){h.rateLimitReset=!1},1e3*h.rateLimitResetCount+1e3))),a.reload_room&&h.roomSubscription.reload_room()},rejected:function(){h.logger.debug("AC Rejected: "+h.roomSubscription.identifier)},unsubscribe:function(){h.logger.debug("AC Unsubscribed: "+h.roomSubscription.identifier),h.roomSubscription=null},login:function(a){h.logger.debug("AC Perform: login"),h.roomSubscription.perform("login",a)},accept:function(){h.logger.debug("AC Perform: accept"),h.roomSubscription.perform("accept")},room_data:function(){h.logger.debug("AC Perform: room_data"),h.roomSubscription.perform("room_data")},reload_room:function(){h.logger.debug("AC Perform: reload"),h.roomSubscription.perform("reload_room")},msg:function(a){h.logger.debug("AC Perform: msg"),h.roomSubscription.perform("msg",a)}},this.ea=e,this.auth=b,this.websocket=f,this.settings=g,this.logger=i.getLogger("private-room"),this.ea.subscribe(k,function(a){h.resubscribeToRoom(a.private)}),setInterval(function(){return h.refreshTime()},6e4)}return a.prototype.attached=function(){var a=this;this.newMessageAudio=new Audio("sounds/new-message.mp3"),this.userEnterAudio=new Audio("sounds/user-enter.mp3"),window.addEventListener("focus",function(){a.chatVisible=!0,a.logger.debug("focus")}),window.addEventListener("blur",function(){a.chatVisible=!1,a.logger.debug("blur")}),document.addEventListener("visibilitychange",function(){a.logger.debug("visibilitychange"),document.hidden?(a.chatVisible=!1,a.logger.debug("tab hidden")):(a.chatVisible=!0,a.logger.debug("tab visible"))})},a.prototype.deattached=function(){window.removeEventListener("focus"),window.removeEventListener("blur"),document.removeEventListener("visibilitychange")},a.prototype.refreshTime=function(){this.currentTime=p();
},a.prototype.scrollContainerToBottom=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;setTimeout(function(){if(0==b)return void(a.container.scrollTop=a.container.scrollHeight);var c=a.container.offsetHeight+a.container.scrollTop;if(a.lastScrollHeight>0){var d=a.container.scrollHeight-a.lastScrollHeight;b+=d}c+b>a.container.scrollHeight&&(a.container.scrollTop=a.container.scrollHeight),a.lastScrollHeight=a.container.scrollHeight},50)},a.prototype.unsubscribeFromChannel=function(){this.roomSubscription&&(this.logger.debug("AC Unsubscribing: "+this.roomSubscription.identifier),this.websocket.getConsumer().subscriptions.remove(this.roomSubscription),this.roomSubscription.unsubscribe())},a.prototype.reloadChannel=function(){this.websocket.getConsumer().subscriptions.remove(this.roomSubscription),this.websocket.getConsumer().subscriptions.add(this.roomSubscription)},a.prototype.resubscribeToRoom=function(a){this.unsubscribeFromChannel(),this.roomSubscription=this.websocket.getConsumer().subscriptions.create({channel:"PrivateChannel",gid:a.gid},this.roomSubscriptionCallback),this.logger.debug("AC Subscribing: "+this.roomSubscription.identifier)},a.prototype.sendMessage=function(a){13!=a.keyCode||this.rateLimitReset||(this.roomSubscription.msg({content:this.currentMsg}),this.currentMsg="")},a.prototype.closePrivateChat=function(){this.unsubscribeFromChannel(),this.chat.hideAll()},a}(),t=e(s.prototype,"chat",[h],{enumerable:!0,initializer:null}),r=s))||r)),a("PrivateRoom",u)}}}),function(){var a=System.amdDefine;a("pages/room.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customelements/msg-content"></require><require from="customelements/user-label"></require><require from="customattributes/enter-press"></require><require from="customattributes/open-in-browser"></require><require from="valueconverters/date-from"></require><require from="valueconverters/take"></require><div class="room-wrapper"><!-- room not choosen yet --><div if.bind="!room && wsIsOpen" class="valign-wrapper"><div class="valign text-center"><div if.bind="isAuthenticated" class="text-muted"><p>You\'re logged in as</p><a href="#" class="user-label large"><img src="${chat.currentUserAvatar}"></a><h4 class="text-muted">${chat.currentUserName}</h4></div><h2 class="text-muted fa fa-3x fa-arrow-circle-left"></h2></div></div><div class="room-overlay ${(!wsIsOpen || rateLimitReset) ? \'active\':\'\'}"><div class="valign-wrapper"><div if.bind="!wsIsOpen" class="valign text-center"><h2 class="text-muted">Connecting...</h2><i class="fa fa-circle-o-notch fa-3x fa-spin"></i></div><div if.bind="rateLimitReset" class="valign text-center"><h2 class="text-muted">Ho ho ho, to many words!</h2><i class="fa fa-chain-broken fa-3x fa-spin"></i><h3 class="text-muted">Wait a minute to send next message.</h3></div></div></div><div if.bind="room" class="room"><nav class="room-navbar"><ul class="nav navbar-nav"><li><a title="Toggle artist/track room" href="#" class="fa fa-exchange fa-rotate-90" click.delegate="changeRoomType()"></a></li></ul><ul if.bind="currentRoom.artist && currentRoom.song" class="room-header"><small>${currentRoom.artist}</small><div class="room-title song">${currentRoom.song}</div></ul><ul if.bind="currentRoom.artist && !currentRoom.song" class="room-header"><div class="room-title">${currentRoom.artist}</div></ul></nav><div class="users"><div class="users-more text-muted ${anonCount > 0 ? \'anon-count\' : \'\'}">${users.length + anonCount} ${users.length + anonCount == 1 ? \'person\' : \'people\'} <small if.bind="anonCount > 0">${anonCount} anonymous</small></div><div if.bind="users.length <= 0 && anonCount <= 0" class="users-info-text">No one visiting this room</div><div if.bind="users.length <= 0 && anonCount > 0" class="users-info-text">${anonCount} anonym. person visiting this room</div><!-- <span > --><!-- <span>\n            <a id="dLabel" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">\n              <img src="${user.avatar}" title="${user.name}"/>\n            </a>\n          </span> --><user-label repeat.for="user of users | take:8" class="user-label" chat.bind="chat" user.bind="user" with-menu="true"></user-label><!-- </span> --></div><div class="msgs"><div style="position:relative"><div if.bind="(users.length + anonCount) <= 1" class="share-notice">Never be alone in this room again!<br><a open-in-browser="https://chatplayer.github.io/#footer" href="#">Share</a> this app to your friends</div></div><div class="msgs-inner" ref="container"><div if.bind="(users.length + anonCount) == 1" class="share-notice-blank"></div><h4 class="text-muted text-center" if.bind="msgs.length <= 0">No one said a word here.<br>What about you?</h4><div repeat.for="msg of msgs" class="msg ${grouped = msg.user.id != msgs[$index-1].user.id ? \'grouped\':null} ${lastingroup = msg.user.id != msgs[$index+1].user.id ? \'lastingroup\':\'\'}"><div class="user-label ${!grouped ? \'dis\':\'\'}"><img if.bind="grouped" class="media-object" src="${msg.user.avatar}"></div><div class="msg-body"><div class="msg-head" if.bind="grouped">${msg.user.name}</div><msg-content content.bind="msg.content"></msg-content><small if.bind="lastingroup" class="created-at">${msg.created_at | dateFrom: currentTime}</small></div></div></div></div><div class="send-message"><div class="send-message-inner"><div if.bind="!isAuthenticated" class="text-center"><h4 class="text-muted">Log in right away, you can miss interesting conversation anytime!</h4><a click.delegate="chat.show(\'login\')" href="#" class="btn btn-primary">Login to write</a></div><div if.bind="isAuthenticated" class="send-row"><div class="dropup dropup-col"><a href="#" data-toggle="dropdown" title="${chat.currentUserName}" class="user-label"><img src="${chat.currentUserAvatar}"> <span class="caret"></span></a><ul class="dropdown-menu" aria-labelledby="dLabel"><li if.bind="!isAuthenticated"><a href="#" click.delegate="chat.show(\'login\')">Login</a></li><li if.bind="isAuthenticated"><a href="#" click.delegate="chat.show(\'favs\')">Favorite chatters</a></li><li if.bind="isAuthenticated"><a href="#" click.delegate="chat.show(\'privateChats\')">Private chats</a></li><li if.bind="isAuthenticated"><a href="#" click.delegate="chat.show(\'userProfile\')">Your profile</a></li><li if.bind="isAuthenticated"><a href="#" click.delegate="chat.show(\'faq\')">Getting started</a></li><li if.bind="isAuthenticated"><a href="#" click.delegate="auth.logout()">Logout</a></li></ul></div><div class="send-col"><input type="text" placeholder="Talk in ${currentRoom.song ? currentRoom.song : currentRoom.artist} room" class="form-control" value.bind="currentMsg" keyup.delegate="sendMessage($event)"></div></div></div></div></div></div></template>'})}(),System.register("services/cable.js",["es6-actioncable","../configs/chat"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f;return{setters:[function(a){d=a.default},function(a){e=a.configChat}],execute:function(){a("Websocket",f=function(){function a(){c(this,a)}return a.prototype.getConsumer=function(){return this.consumer||this.connect(),this.consumer},a.prototype.connect=function(){this.consumer=d.createConsumer(e.wshost)},a.prototype.closeConnection=function(){this.consumer&&d.endConsumer(this.consumer),delete this.consumer},a}()),a("Websocket",f)}}}),System.register("utility.js",[],function(a,b){"use strict";function c(a,b){return Object.keys(a).every(function(c){return b.hasOwnProperty(c)&&a[c]===b[c]})}return a("areEqual",c),{setters:[],execute:function(){}}}),System.register("pages/room.js",["aurelia-framework","aurelia-event-aggregator","events/room","services/cable","services/settings","aurelia-authentication","../utility","fetch","moment"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return{setters:[function(a){f=a.observable,g=a.inject,h=a.bindable,i=a.computedFrom,j=a.LogManager},function(a){k=a.EventAggregator},function(a){l=a.RoomFind},function(a){m=a.Websocket},function(a){n=a.Settings},function(a){o=a.AuthService},function(a){p=a.areEqual},function(a){},function(a){q=a.default}],execute:function(){r=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Room",(s=g(o,k,m,n),x=s((u=function(){function a(b,e,f,g){var h=this;d(this,a),c(this,"currentRoom",v,this),c(this,"chat",w,this),this.msgs=[],this.users=[],this.room=null,this.currentMsg=null,this.showLogin=!0,this.showSignup=!0,this.roomType=1,this.roomDataForType=null,this.rateLimitReset=!1,this.rateLimitResetCount=0,this.anonCount=0,this.currentTime=q(),this.chatVisible=!0,this.lastScrollHeight=0,this.roomSubscriptionCallback={connected:function(){h.logger.debug("AC Connected: "+h.roomSubscription.identifier),h.roomSubscription.room_data()},disconnected:function(){h.logger.debug("AC Disconnected: "+h.roomSubscription.identifier)},received:function(a){if(a.room_data&&(h.room=a.room_data,h.auth.authentication.getAccessToken()&&h.roomSubscription.login({token:h.auth.authentication.getAccessToken()})),a.user_enter){h.logger.debug("AC Receive: user_enter");var b=h.users.findIndex(function(b){return b.id==a.user_enter.id});b===-1&&(h.users.push(a.user_enter),h.users.length>1&&!h.chatVisible&&h.userEnterAudio.play())}if(a.user_leave){var c=h.users.findIndex(function(b){return b.id==a.user_leave.id});h.users.splice(c,1)}a.anons_count&&(h.anonCount=parseInt(a.anons_count)),a.list_msgs&&(h.msgs=a.list_msgs,h.scrollContainerToBottom()),a.list_users&&(h.logger.debug("AC Receive: list_users"),h.users=a.list_users),a.content&&(h.msgs.push(a),h.scrollContainerToBottom(100),h.chatVisible||h.newMessageAudio.play()),a.rate_limit_reset&&(h.rateLimitResetCount=a.rate_limit_reset,h.rateLimitReset||(h.rateLimitReset=!0,setTimeout(function(){h.rateLimitReset=!1},1e3*h.rateLimitResetCount+1e3)))},rejected:function(){h.logger.debug("AC Rejected: "+h.roomSubscription.identifier)},unsubscribe:function(){h.logger.debug("AC Unsubscribed: "+h.roomSubscription.identifier),h.roomSubscription=null},room_data:function(){h.logger.debug("AC Perform: room_data"),h.roomSubscription.perform("room_data")},login:function(a){h.logger.debug("AC Perform: login"),h.roomSubscription.perform("login",a)},logout:function(a){h.logger.debug("AC Perform: logout"),h.roomSubscription.perform("logout",a)},msg:function(a){h.logger.debug("AC Perform: msg"),h.roomSubscription.perform("msg",a)}},this.ea=e,this.auth=b,this.websocket=f,this.settings=g,this.logger=j.getLogger("room"),this.settings.find("room-type").then(function(a){void 0!==a&&(h.roomType=a)}),e.subscribe("authentication-change",function(a){h.roomSubscription&&(a?h.roomSubscription.login({token:h.auth.authentication.getToken()}):h.roomSubscription.logout())}),e.subscribe(l,function(a){h.logger.debug("RoomFind: ",a),h.roomDataForType={1:{artist:a.room.artist,song:a.room.song,gid:a.room.song_gid},2:{artist:a.room.artist,song:null,gid:a.room.artist_gid}},h.currentRoom=h.roomDataForType[h.roomType]}),setInterval(function(){return h.refreshTime()},6e4)}return a.prototype.attached=function(){this.newMessageAudio=new Audio("sounds/new-message.mp3"),this.userEnterAudio=new Audio("sounds/user-enter.mp3"),this.attachVisibilityEvents()},a.prototype.deattached=function(){this.deattachVisibilityEvents()},a.prototype.refreshTime=function(){this.currentTime=q()},a.prototype.scrollContainerToBottom=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;setTimeout(function(){if(0==b)return void(a.container.scrollTop=a.container.scrollHeight);var c=a.container.offsetHeight+a.container.scrollTop;if(a.lastScrollHeight>0){var d=a.container.scrollHeight-a.lastScrollHeight;b+=d}c+b>a.container.scrollHeight&&(a.container.scrollTop=a.container.scrollHeight),a.lastScrollHeight=a.container.scrollHeight},50)},a.prototype.changeRoomType=function(){this.roomType=1==this.roomType?2:1,this.currentRoom=this.roomDataForType[this.roomType],this.settings.save("room-type",this.roomType)},a.prototype.currentRoomChanged=function(a,b){a&&b&&!p(a,b)?this.resubscribeToRoom(a):a&&!b&&this.resubscribeToRoom(a)},a.prototype.resubscribeToRoom=function(a){this.roomSubscription&&(this.websocket.getConsumer().subscriptions.remove(this.roomSubscription),this.roomSubscription.unsubscribe());var b=Object.assign({},{channel:"RoomsChannel"},a);this.roomSubscription=this.websocket.getConsumer().subscriptions.create(b,this.roomSubscriptionCallback)},a.prototype.sendMessage=function(a){13!=a.keyCode||this.rateLimitReset||(this.roomSubscription.msg({content:this.currentMsg}),this.currentMsg="")},a.prototype.attachVisibilityEvents=function(){var a=this;window.addEventListener("focus",function(){a.chatVisible=!0,a.logger.debug("focus")}),window.addEventListener("blur",function(){a.chatVisible=!1,a.logger.debug("blur")}),document.addEventListener("visibilitychange",function(){a.logger.debug("visibilitychange"),document.hidden?(a.chatVisible=!1,a.logger.debug("tab hidden")):(a.chatVisible=!0,a.logger.debug("tab visible"))})},a.prototype.deattachVisibilityEvents=function(){window.removeEventListener("focus"),window.removeEventListener("blur"),document.removeEventListener("visibilitychange")},r(a,[{key:"isAuthenticated",get:function(){return this.auth.authenticated}},{key:"wsIsOpen",get:function(){return!!this.websocket.consumer&&this.websocket.consumer.connection.isOpen()}}]),a}(),v=e(u.prototype,"currentRoom",[f],{enumerable:!0,initializer:null}),w=e(u.prototype,"chat",[h],{enumerable:!0,initializer:null}),t=u))||t)),a("Room",x)}}}),function(){var a=System.amdDefine;a("pages/weblib.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="blur-image"></require><require from="valueconverters/date-format"></require><nav class="navbar navbar-default subpage-navbar"><ul class="nav navbar-nav"><li><a class="fa fa-search"></a></li></ul><ul class="nav navbar-nav navbar-right"><li><a if.bind="spotify.http.isRequesting" class="fa fa-circle-o-notch fa-spin"></a></li></ul><ul class="nav nav-justified"><li><form class="navbar-form"><input type="text" value.bind="searchPhrase & debounce:650" class="form-control search-input" placeholder="Search music on the web..." autofocus></form></li></ul></nav><div class="subpage-content container-fluid"><div if.bind="!anySearchResults"><h2 class="text-muted text-center">Find your favorite music and start chatting</h2><div class="text-center text-muted"><i class="fa fa-3x fa-keyboard-o"></i></div></div><div if.bind="anySearchResults" class="row" style="height:100%"><div class="col-xs-3" style="height:100%"><div class="search-results"><h2 if.bind="!someSearchResults" class="text-muted text-center">Nothing found</h2><div class="bs-callout" if.bind="searchResults.artists.items.length > 0"><h5 class="text-muted">Artists</h5><div class="media" repeat.for="artist of searchResults.artists.items" click.delegate="getArtistsAlbums(artist.gid)"><div class="media-left"><a href="#"><img if.bind="artist.images[2][\'url\']" src.bind="artist.images[2][\'url\']" class="media-object img-responsive"> <i if.bind="!artist.images[2][\'url\']" class="fa fa-star-o media-object"></i></a></div><div class="media-body media-middle" title="${artist.name}">${artist.name}</div><div class="media-right media-middle"><span class="fa fa-angle-right"></span></div></div></div><div class="bs-callout" if.bind="searchResults.albums.items.length > 0"><h5 class="text-muted">Albums</h5><div class="media" repeat.for="album of searchResults.albums.items" click.delegate="getArtistAlbum(album.gid)"><div class="media-left"><a href="#"><img if.bind="album.images[2][\'url\']" src.bind="album.images[2][\'url\']" class="media-object img-responsive"> <i if.bind="!album.images[2][\'url\']" class="fa fa-circle-o media-object"></i></a></div><div class="media-body media-middle" title="${album.name}">${album.name}</div><div class="media-right media-middle"><span class="fa fa-angle-right"></span></div></div></div><div class="bs-callout" if.bind="searchResults.tracks.items.length > 0"><h5 class="text-muted">Tracks</h5><div class="media" repeat.for="track of searchResults.tracks.items" click.delegate="getArtistAlbum(track.album.gid)"><div class="media-left"><a href="#"><img if.bind="track.images[2][\'url\']" src.bind="track.images[2][\'url\']" class="media-object img-responsive"> <i if.bind="!track.images[2][\'url\']" class="fa fa-music media-object"></i></a></div><div class="media-body media-middle" title="${track.name}">${track.name} <span class="small">${track.artists[0].name}</span></div><div class="media-right media-middle"><span class="fa fa-angle-right"></span></div></div></div></div></div><div class="col-xs-9" style="height:100%"><div class="div-table-row head"><div class="col-xs-1">#</div><div class="col-xs-3">Track</div><div class="col-xs-1 text-center"><i class="fa fa-clock-o"></i></div><div class="col-xs-3">Artist</div><div class="col-xs-3">Album</div><div class="col-xs-1 text-center"><i class="fa fa-calendar-o"></i></div><!-- <div class="col-xs-1"><i class="fa fa-bullhorn"></i></div> --></div><div class="div-table absolute" ref="listResults"><div virtual-repeat.for="item of musicResults" infinite-scroll-next="getMoreFromArtist" click.delegate="searchOnYTAndPlay(item)" class="div-table-row ${item.gid === selectedId ? \'active\' : \'\'}"><div class="col-xs-1">${item.position}</div><div class="col-xs-3 toverflow" title="${item.name}">${item.name}</div><div class="col-xs-1 text-center">${item.length | dateFormat: \'m:ss\'}</div><div class="col-xs-3 toverflow" title="${item.artists[0].name}">${item.artists[0].name}</div><div class="col-xs-3 toverflow" title="${item.album.name}">${item.album.name}</div><div class="col-xs-1 text-center">${item.album.release_at | dateFormat: \'YYYY\'}</div><!-- <div class="col-xs-1">${item.album.release}</div> --></div></div></div></div></div></template>'})}(),System.register("services/search-client.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[function(a){d=a.inject}],execute:function(){a("SearchClient",(e=d("SearchClient"),g=e(f=function(){function a(b){c(this,a),this.http=b}return a.prototype.search=function(a){return this.http.fetch("/search/all?q="+encodeURIComponent(a)).then(function(a){return a.json()})},a.prototype.searchArtistGidAndTrackGid=function(a,b){var c="artist_gid="+encodeURIComponent(a);return b&&(c=c+"&track_gid="+encodeURIComponent(b)),this.http.fetch("/search/all?"+c).then(function(a){return a.json()})},a.prototype.searchArtistAndTrack=function(a,b){var c="artist_name="+encodeURIComponent(a);return b&&(c=c+"&track_name="+encodeURIComponent(b)),this.http.fetch("/search/all?"+c).then(function(a){return a.json()})},a.prototype.artistsTopTracks=function(a){return this.http.fetch("/artists/"+a+"/top-tracks?country=SE").then(function(a){return a.json()})},a.prototype.album=function(a){return this.http.fetch("/albums/"+a).then(function(a){return a.json()})},a.prototype.albums=function(a){return this.http.fetch("/albums/?ids="+a.join(",")).then(function(a){return a.json()})},a.prototype.artistAlbums=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return this.http.fetch("/artists/"+a+"/albums?album_type=album,single&limit="+c+"&offset="+b+"&country=SE").then(function(a){return a.json()})},a}())||f)),a("SearchClient",g)}}}),System.register("services/http-client-json.js",["aurelia-framework","aurelia-fetch-client"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f,g,h;return{setters:[function(a){f=a.inject},function(a){g=a.HttpClient}],execute:function(){a("HttpClientJson",h=function(a){function b(e){c(this,b);var f=d(this,a.call(this));return f.configure(function(a){a.useStandardConfiguration().withBaseUrl(e).withDefaults({headers:{Accept:"application/json","Content-Type":"application/json"}})}),f}return e(b,a),b}(g)),a("HttpClientJson",h)}}}),System.register("services/googleapis-client.js",["aurelia-framework","../configs/platform","services/http-client-json"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.inject},function(a){e=a.platform},function(a){f=a.HttpClientJson}],execute:function(){a("GoogleapisClient",(g=d("GoogleClient"),i=g(h=function(){function a(b){c(this,a),this.http=b,e.web?this.apiKey="AIzaSyAjXHKPMS_PyhOgvmkIxFflh0umDARprXM":this.apiKey="AIzaSyAF-_zDCe3Gd9efnbF9mKzJt4S-gT7VT54"}return a.prototype.youtubeSearch=function(a){var b=this;return this.http.fetch("/youtube/v3/search?part=snippet&maxResults=10&q="+encodeURIComponent(a)+"&safeSearch=none&type=video&videoSyndicated=true&videoEmbeddable=true&videoCaption=any&videoDefinition=any&key="+this.apiKey).then(function(a){return a.json()}).then(function(a){var c=a.items.map(function(a){return a.id.videoId});return b.youtubeVideoList(c)})},a.prototype.youtubeVideoList=function(a){return this.http.fetch("/youtube/v3/videos?part=contentDetails&id="+a.join(",")+"&key="+this.apiKey).then(function(a){return a.json()})},a}())||h)),a("GoogleapisClient",i)}}}),System.register("pages/weblib.js",["aurelia-framework","aurelia-event-aggregator","aurelia-fetch-client","../services/search-client","../services/googleapis-client","../events/player","../events/room","aurelia-router","moment"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;return{setters:[function(a){f=a.inject,g=a.bindable,h=a.singleton,i=a.LogManager},function(a){j=a.EventAggregator},function(a){k=a.HttpClient},function(a){l=a.SearchClient},function(a){m=a.GoogleapisClient},function(a){n=a.PlayerPlay,o=a.PlayerNext,p=a.PlayerPrev},function(a){q=a.PlayFromRoomObject},function(a){r=a.Router},function(a){s=a.default}],execute:function(){t=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Weblib",(u=h(),v=f(k,l,m,j,r),z=u(w=v((x=function(){function a(b,e,f,g,h){var j=this;d(this,a),c(this,"searchPhrase",y,this),this.searchResults=[],this.musicResults=[],this.musicResultsOffset=0,this.selectedId=null,this.selectedItem=null,this.selectedArtistId=null,this.youtubeResults=[],this.youtubeAttempt=0,this.urlArtistName=null,this.notFoundResultsFromParams=!1,b.configure(function(a){a.useStandardConfiguration()}),this.http=b,this.search=e,this.googleapis=f,this.ea=g,this.router=h,this.logger=i.getLogger("weblib"),g.subscribe(o,function(a){a.ytPlayer&&j.playNext()}),g.subscribe(p,function(a){a.ytPlayer&&j.playPrev()}),this.ea.subscribe("ytplayer:error",function(a){j.youtubeAttempt++,j.playInYtPlayer(j.youtubeAttempt)}),this.ea.subscribe(q,function(a){j.logger.debug("PlayFromRoomObject",a.room),j.playFromUrlParams(a.room)})}return a.prototype.activate=function(a,b){this.playFromUrlParams(a)},a.prototype.playFromUrlParams=function(a){var b=this;if(this.notFoundResultsFromParams=!1,a.artist){this.logger.debug("playFromUrlParams",a),a.artist_gid="-"==a.artist_gid?null:a.artist_gid,a.song_gid="-"==a.song_gid?null:a.song_gid;var c=void 0;a.artist_gid||a.artist_gid&&a.song_gid?(this.logger.debug("using searchArtistGidAndTrackGid"),c=this.search.searchArtistGidAndTrackGid(a.artist_gid,a.song_gid)):(a.artist||a.artist&&a.song)&&(this.logger.debug("using searchArtistAndTrack"),c=this.search.searchArtistAndTrack(a.artist,a.song)),c.then(function(a){return b.logger.debug("searchPromise",a),a.artists.items.length>0?{artist:a.artists.items[0]}:a.tracks.items.length>0?{artist:a.tracks.items[0].artists[0],track:a.tracks.items[0]}:void 0}).then(function(a){b.logger.debug("searchArtistAndTrack results",a),a&&(a.artist&&a.track?b.getArtistAlbum(a.track.album.gid).then(function(){b.playByName(a.track.name)}):a.artist&&b.selectedArtistId!=a.artist.gid&&(b.getArtistsAlbums(a.artist.gid).then(function(){b.searchOnYTAndPlay(b.musicResults[0])}),b.logger.debug("selectedItem results",b.selectedItem)))})}},a.prototype.searchPhraseChanged=function(a){var b=this;""!=a&&" "!=a&&this.search.search(a).then(function(a){console.log(a),b.searchResults=a})},a.prototype.getArtistsTopTracks=function(a){var b=this;return this.search.artistsTopTracks(a).then(function(a){b.musicResults=a.tracks})},a.prototype.scrollTopAndSpliceMusicResults=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(c,d){b?(a.musicResultsOffset=0,setTimeout(function(){a.listResults.scrollTop=0}),setTimeout(function(){a.musicResults.splice(0),c(!0)},500)):c(!0)})},a.prototype.getArtistsAlbums=function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.scrollTopAndSpliceMusicResults(0==c).then(function(){return b.search.artistAlbums(a,c)}).then(function(c){b.logger.debug("artistAlbums",c),b.selectedArtistId=a;var d=c.items.map(function(a){return a.gid});return 0==d.length?[]:(b.musicResultsOffset=b.musicResultsOffset+d.length,d)}).then(function(a){return 0==a.length?[]:b.search.albums(a)}).then(function(a){return b.logger.debug("albums",a),0!=a.length&&void a.albums.map(function(a){a.tracks.items.map(function(c){c.album={name:a.name,release_at:a.release_at},b.musicResults.push(c)})})})},a.prototype.getMoreFromArtist=function(a,b,c){b&&this.selectedArtistId&&this.getArtistsAlbums(this.selectedArtistId,this.musicResultsOffset)},a.prototype.getArtistAlbum=function(a){var b=this;return this.selectedArtistId=null,this.scrollTopAndSpliceMusicResults(!0).then(function(){return b.search.album(a)}).then(function(a){return a.tracks.items.map(function(c){c.album={name:a.name,release:a.release_date},b.musicResults.push(c)}),a})},a.prototype.searchOnYTAndPlay=function(a){var b=this;this.selectedId=a.gid,this.selectedItem=a;var c=a.artists[0].name+" "+a.name;return this.googleapis.youtubeSearch(c).then(function(c){var d=c.items.filter(function(a){var c=s.duration(a.contentDetails.duration).asMilliseconds();return c>b.selectedItem.length-6e4&&c<b.selectedItem.length+18e4});b.youtubeResults=d,b.youtubeAttempt=0,b.playInYtPlayer(),b.setNewUrlAndTitle(a.artists[0].name,a.artists[0].gid,a.name,a.gid)})},a.prototype.playInYtPlayer=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=Object.assign(this.selectedItem,{youtubeId:this.youtubeResults[a].id});this.ea.publish(new n(b))},a.prototype.playNext=function(){for(var a=0;a<this.musicResults.length;a++)if(this.musicResults[a].gid===this.selectedId){this.selectedId=this.musicResults[a+1].gid,this.searchOnYTAndPlay(this.musicResults[a+1]);break}},a.prototype.playPrev=function(){for(var a=0;a<this.musicResults.length;a++)if(this.musicResults[a].gid===this.selectedId){this.selectedId=this.musicResults[a-1].gid,this.searchOnYTAndPlay(this.musicResults[a-1]);break}},a.prototype.playByName=function(a){for(var b=0;b<this.musicResults.length;b++)if(this.musicResults[b].name==a){this.searchOnYTAndPlay(this.musicResults[b]);break}},a.prototype.setNewUrlAndTitle=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.router.title=a+" "+c;var e={artist:encodeURIComponent(a),artist_gid:b?encodeURIComponent(b):"-",song:encodeURIComponent(c),song_gid:d?encodeURIComponent(d):"-"};this.router.updateTitle(),this.router.navigateToRoute(this.router.currentInstruction.config.name,e,{trigger:!1})},t(a,[{key:"anySearchResults",get:function(){return this.searchResults.artists&&(this.searchResults.artists.items.length>0||this.searchResults.albums.items.length>0||this.searchResults.tracks.items.length>0)||this.musicResults.length>0}},{key:"someSearchResults",get:function(){return this.searchResults.artists&&this.searchResults.artists.items.length>0&&this.searchResults.albums.items.length>0&&this.searchResults.tracks.items.length>0}}]),a}(),y=e(x.prototype,"searchPhrase",[g],{enumerable:!0,initializer:null}),w=x))||w)||w)),a("Weblib",z)}}}),function(){var a=System.amdDefine;a("partials/faq.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="overlay-table"><div class="overlay-navbar"><a class="close" click.delegate="chat.hideAll()" href="#">&times;</a><div class="overlay-header"><div class="overlay-title">Getting started</div></div></div><div class="overlay-content"><ul><li>ChatPlayer is new project, so please invite your friends share it to others</li><li>Try playing some popular artists or tracks, you will meet new people faster</li><li>Be nice, listen music and socialize with people</li></ul><h3 class="text-center">Good luck!</h3></div></div></template>'})}(),function(){var a=System.amdDefine;a("partials/follow-notify.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="notify-overlay ${show ? \'show\':\'\'}"><div class="overlay-navbar"><span class="pull-right text-muted close" click.delegate="closeAndunfollowAllNow()">STOP</span><div class="overlay-header"><div class="overlay-title">You will enter room in <strong>${timeToFollow}s</strong></div></div></div><div class="overlay-content"><div class="media user-label medium"><div class="media-left"><a href="#"><img src="${user.avatar}" class="media-object"></a></div><div class="media-body"><div class="media-heading">${user.name}</div><strong class="text-capitalize"><i class="fa fa-play"></i> ${room.artist} ${room.song ? \'-\':\'\'} ${room.song}</strong></div><!-- <div class="media-right media-middle">\n          <a title="stop following ${user.name}" href="#" click.delegate="closeAndunfollowAllNow()"><i class="fa fa-stop fa-2x"></i></a>\n        </div> --></div></div></div></template>';
})}(),System.register("events/room.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[],execute:function(){a("RoomFind",d=function a(b){c(this,a),this.room=b}),a("RoomFind",d),a("PlayFromRoomObject",e=function a(b){c(this,a),this.room=b}),a("PlayFromRoomObject",e)}}}),System.register("events/player.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f;return{setters:[],execute:function(){a("PlayerPlay",d=function a(b){c(this,a),b.path?(this.localPath=b.path,this.artist="string"==typeof b.artist?b.artist:b.artist[0],this.album=b.album,this.song=b.song):b.youtubeId&&(this.youtubeId=b.youtubeId,this.artist=b.artists[0].name,this.album=b.album.name,this.song=b.name,this.song_gid=b.gid,this.artist_gid=b.artists[0].gid)}),a("PlayerPlay",d),a("PlayerNext",e=function a(b){c(this,a),b.YtPlayerAPI?this.ytPlayer=!0:b.Html5PlayerAPI&&(this.html5Player=!0)}),a("PlayerNext",e),a("PlayerPrev",f=function a(b){c(this,a),b.YtPlayerAPI?this.ytPlayer=!0:b.Html5PlayerAPI&&(this.html5Player=!0)}),a("PlayerPrev",f)}}}),System.register("partials/follow-notify.js",["aurelia-framework","aurelia-event-aggregator","events/user","events/room","events/player"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q;return{setters:[function(a){f=a.inject,g=a.bindable,h=a.LogManager},function(a){i=a.EventAggregator},function(a){j=a.UserFollowNotify},function(a){k=a.PlayFromRoomObject},function(a){l=a.PlayerPlay}],execute:function(){a("FollowNotify",(m=f(i),q=m((o=function(){function a(b){var e=this;d(this,a),c(this,"chat",p,this),this.show=!1,this.timeout=5,this.timeToFollow=0,this.logger=h.getLogger("follow-notify"),this.ea=b,this.ea.subscribe(j,function(a){e.logger.debug("receive follow event: ",a),e.user=a.user,e.room=a.room,e.show=!0,e.timeToFollow=e.timeout}),setInterval(function(){return e.refreshTime()},1e3)}return a.prototype.refreshTime=function(){this.show&&(this.timeToFollow>0?this.timeToFollow-=1:0==this.timeToFollow&&(this.show=!1,this.timeToFollow=this.timeout,this.ea.publish(new k(this.room))))},a.prototype.closeAndunfollowAllNow=function(){this.chat.unfollowAllNow(),this.show=!1},a}(),p=e(o.prototype,"chat",[g],{enumerable:!0,initializer:null}),n=o))||n)),a("FollowNotify",q)}}}),function(){var a=System.amdDefine;a("partials/forgot.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div if.bind="chat.router.forgotSent" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">All good!</h2><h4 class="text-center text-muted">Check your email</h4><p class="text-muted">We send you an email with password recovery instructions</p></div><div if.bind="chat.router.forgot" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Forgot password?</h2><p class="text-muted">Please fill form to receive email with new password</p><form role="form" submit.delegate="submit()"><div class="form-group"><label for="fn">Email</label><input type="text" value.bind="email & validate" class="form-control" id="fn" placeholder="email"></div><button type="submit" class="btn btn-default">Send <i if.bind="http.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form><br><p class="text-center text-muted">Already have account? <a click.delegate="chat.show(\'login\')" href="#">Log in</a></p></div></template>'})}(),System.register("configs/environment.js",[],function(a,b){"use strict";var c;return{setters:[],execute:function(){a("env",c="production"),a("env",c)}}}),System.register("configs/chat.js",["./environment"],function(a,b){"use strict";var c,d,e,f,g;return{setters:[function(a){c=a.env}],execute:function(){f={},d={client:"http://localhost:9000/",host:"http://localhost:3000/",wshost:"ws://localhost:3000/cable",search_host:"https://s.chatplayer.it"},e={client:"https://chatplayer.github.io/app/",host:"https://chatplayer.herokuapp.com/",wshost:"wss://chatplayer.herokuapp.com/cable",search_host:"https://s.chatplayer.it"},f=Object.assign(f,"development"===c?d:e),a("configChat",g=f),a("configChat",g)}}}),System.register("services/http-client-with-auth.js",["aurelia-framework","aurelia-fetch-client","../configs/chat","aurelia-authentication"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.inject},function(a){e=a.HttpClient},function(a){f=a.configChat},function(a){g=a.FetchConfig}],execute:function(){a("HttpClientWithAuth",(h=d(e,g),j=h(i=function a(b,d){return c(this,a),this.fetchConfig=d,this.fetchConfig.configure(),b.configure(function(a){a.useStandardConfiguration().withDefaults({headers:{Accept:"application/json","Content-Type":"application/json"}}).withBaseUrl(f.host).withInterceptor({request:function(a){return console.log("Requesting "+a.method+" "+a.url),a},response:function(a){return console.log("Received "+a.status+" "+a.url),a}})})})||i)),a("HttpClientWithAuth",j)}}}),System.register("partials/forgot.js",["aurelia-framework","aurelia-fetch-client","../services/http-client-with-auth","aurelia-validation","../bootstrap-form-renderer"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.json},function(a){i=a.HttpClientWithAuth},function(a){j=a.ValidationControllerFactory,k=a.ValidationController,l=a.ValidationRules},function(a){m=a.BootstrapFormRenderer}],execute:function(){a("Forgot",(n=f(i,j),r=n((p=function(){function a(b,e){d(this,a),c(this,"chat",q,this),this.controller=null,this.email="",this.http=b,this.controller=e.createForCurrentScope(),this.controller.addRenderer(new m)}return a.prototype.submit=function(){var a=this;this.controller.validate().then(function(b){0===b.length&&a.forgot()})},a.prototype.forgot=function(){var a=this;return this.http.fetch("users/password",{method:"post",body:h({user:{email:this.email}})}).then(function(b){a.chat.router.forgotSent=!0,a.chat.router.forgot=!1,a.email=""}).catch(function(b){b.json().then(function(b){var c=b.errors;Object.keys(c).map(function(b){a.controller.addError(c[b],a,b)})})})},a}(),q=e(p.prototype,"chat",[g],{enumerable:!0,initializer:null}),o=p))||o)),a("Forgot",r)}}}),function(){var a=System.amdDefine;a("partials/login.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="login-overlay"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Log in</h2><form method="post" name="loginForm"><div class="form-group has-feedback"><input class="form-control" type="text" name="email" value.bind="email" placeholder="E-mail" required autofocus> <span class="ion-at form-control-feedback"></span></div><div class="form-group has-feedback"><input class="form-control" type="password" name="password" value.bind="password" placeholder="Password" required> <span class="ion-key form-control-feedback"></span></div><div if.bind="errors"><div repeat.for="error of errors" class="alert alert-danger text-center">${error}</div></div><button type="submit" click.delegate="login()" class="btn btn-block btn-primary">Log in with e-mail <i if.bind="auth.config.client.client.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form><br><p class="text-center"><small><a click.delegate="chat.show(\'forgot\')" href="#">Forgot your password?</a></small></p><p class="text-center text-muted">Don\'t have an account yet? <a click.delegate="chat.show(\'signup\')" href="#">Sign up</a></p><div if.bind="platform.web" class="signup-or-separator"><h3 class="text-center text-muted">- or -</h3><br></div><button if.bind="platform.web" class="btn btn-block btn-google-plus" click.delegate="authenticate(\'google\')">Log in with Google</button><br><button if.bind="platform.web" class="btn btn-block btn-facebook" click.delegate="authenticate(\'facebook\')">Log in with Facebook</button></div></template>'})}(),System.register("configs/platform.js",[],function(a,b){"use strict";var c;return{setters:[],execute:function(){a("platform",c=window&&window.process&&"renderer"==window.process.type?{electron:!0}:{web:!0}),a("platform",c)}}}),System.register("partials/login.js",["aurelia-authentication","aurelia-framework","aurelia-router","../configs/platform","fetch"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q;return{setters:[function(a){f=a.AuthService},function(a){g=a.observable,h=a.inject,i=a.bindable},function(a){j=a.Router},function(a){k=a.platform},function(a){}],execute:function(){l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Login",(m=h(f,j,k),q=m((o=function(){function a(b,e,f){d(this,a),c(this,"chat",p,this),this.email="",this.password="",this.errors=[],this.auth=b,this.router=e,this.platform=f}return a.prototype.login=function(){var a=this;this.auth.login({user:{email:this.email,password:this.password}}).then(function(b){a.clearErrors(),a.password="",a.platform.web&&a.router.navigate("/")}).catch(function(b){b.json().then(function(b){a.addError(b.error)})})},a.prototype.addError=function(a){this.errors=[],this.errors.push(a)},a.prototype.clearErrors=function(){this.errors=[]},a.prototype.authenticate=function(a){var b=this;return this.auth.authenticate(a).then(function(a){b.clearErrors(),b.platform.web&&b.router.navigate("/")}).catch(function(a){a.json().then(function(a){b.addError(a.error)})})},l(a,[{key:"isAuthenticated",get:function(){return this.auth.isAuthenticated()}}]),a}(),p=e(o.prototype,"chat",[i],{enumerable:!0,initializer:null}),n=o))||n)),a("Login",q)}}}),function(){var a=System.amdDefine;a("partials/nav-bar.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customelements/player-controls"></require><require from="customattributes/sidebar-toggle"></require><nav class="controls-bar" role="navigation"><ul class="nav navbar-nav"><li repeat.for="row of router.navigation" class="${row.isActive ? \'active\' : \'\'}"><a if.bind="row.href != \'#/weblib\'" href.bind="row.href" title="Local music" class="fa fa-2x fa-hdd-o"></a> <a if.bind="row.href == \'#/weblib\'" href.bind="row.href" title="Web music" class="fa fa-2x fa-globe"></a></li></ul><ul class="nav navbar-nav navbar-right"><li><a title="Toggle chat" href="#" class="fa fa-comments-o fa-2x" sidebar-toggle="target: chat-sidebar; opened.bind: chatOpened;" click.delegate="chatOpenedToggle()"></a></li><!-- <li class="loader" style="width:20px;padding:20px">\n        <i if.bind="router.isNavigating || websocket" class="fa fa-circle-o-notch fa-spin fa-2x"></i>\n      </li> --></ul><ul class="nav nav-justified"><li><player-controls chat-opened.bind="chatOpened"></player-controls></li></ul></nav></template>'})}(),System.register("services/settings.js",["aurelia-framework","nedb-promise"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.default}],execute:function(){a("Settings",(f=d(e({filename:"settings.db",autoload:!0})),h=f(g=function(){function a(b){c(this,a),this.db=b}return a.prototype.find=function(a){return this.db.cfind({setting:a}).exec().then(function(a){return a.map(function(a){return a.value})[0]})},a.prototype.save=function(a,b){return this.db.update({setting:a},{setting:a,value:b},{upsert:!0})},a}())||g)),a("Settings",h)}}}),System.register("partials/nav-bar.js",["aurelia-framework","services/settings"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.Settings}],execute:function(){a("NavBar",(i=f(h),m=i((k=function(){function a(b){var e=this;d(this,a),c(this,"router",l,this),this.chatOpened=1,this.settings=b,this.settings.find("chat-sidebar").then(function(a){void 0!==a&&(e.chatOpened=a)})}return a.prototype.chatOpenedToggle=function(){this.chatOpened=1==this.chatOpened?0:1,this.settings.save("chat-sidebar",this.chatOpened)},a}(),l=e(k.prototype,"router",[g],{enumerable:!0,initializer:null}),j=k))||j)),a("NavBar",m)}}}),function(){var a=System.amdDefine;a("partials/private-message-notify.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="notify-overlay ${show ? \'show\':\'\'}"><div class="overlay-navbar"><div class="overlay-header"><div class="overlay-title">New message</div></div></div><div class="overlay-content"><div class="media user-label medium"><div class="media-left"><a href="#"><img src="${user.avatar}" class="media-object"></a></div><div class="media-body"><div class="media-heading">${user.name}</div></div><div class="media-right media-middle"><a title="stop following ${user.name}" href="#" click.delegate="enterPrivateRoom(room)"><i class="fa fa-chevron-right fa-2x"></i></a></div></div></div></div></template>'})}(),System.register("events/user.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[],execute:function(){a("FavoriteUser",d=function a(b){c(this,a),this.user=b}),a("FavoriteUser",d),a("UserEnterPrivateRoom",e=function a(b){c(this,a),this.private=b}),a("UserEnterPrivateRoom",e),a("UserFollowNotify",f=function a(b,d){c(this,a),this.room=b,this.user=d}),a("UserFollowNotify",f),a("UserPrivateMessageNotify",g=function a(b,d){c(this,a),this.room=b,this.user=d}),a("UserPrivateMessageNotify",g)}}}),System.register("partials/private-message-notify.js",["aurelia-framework","aurelia-event-aggregator","events/user"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.EventAggregator},function(a){i=a.UserEnterPrivateRoom,j=a.UserPrivateMessageNotify}],execute:function(){a("PrivateMessageNotify",(k=f(h),o=k((m=function(){function a(b){var e=this;d(this,a),c(this,"chat",n,this),this.show=!1,this.timeout=5,this.ea=b,this.ea.subscribe(j,function(a){e.user=a.user,e.room=a.room,e.show=!0,setTimeout(function(){return e.hide()},1e3*e.timeout)})}return a.prototype.hide=function(){this.show=!1},a.prototype.enterPrivateRoom=function(a){this.ea.publish(new i(a)),this.show=!1},a}(),n=e(m.prototype,"chat",[g],{enumerable:!0,initializer:null}),l=m))||l)),a("PrivateMessageNotify",o)}}}),function(){var a=System.amdDefine;a("partials/signup.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div if.bind="chat.router.confirmAccount" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Thank you!</h2><h3 class="text-center">Confirm your account.</h3><h4 class="text-center text-muted">We sent confirmation link to your e-mail. Please confirm your account and log in.</h4><p class="text-center">Take me to <a href="#" click.delegate="chat.show(\'login\')">Log in</a> page</p></div><div if.bind="chat.router.signupSuccess" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Thank you</h2><h3 class="text-center">You\'re ready to listen and chat!</h3><h4 class="text-center">Take me to <a href="#" click.delegate="chat.show(\'login\')">Log in</a> page</h4></div><div if.bind="chat.router.signup" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Sign Up</h2><h4 class="text-center text-muted">One last step to begin your journey!</h4><form role="form" submit.delegate="submit()"><!-- <ul if.bind="controller.errors">\n        <li repeat.for="error of controller.errors">\n          ${error.message}\n        </li>\n      </ul> --><div class="form-group"><label for="fn">Name</label><input type="text" value.bind="name & validate" class="form-control" id="fn"></div><div class="form-group"><label for="fn">Email</label><input type="text" value.bind="email & validate" class="form-control" id="fn"></div><div class="form-group"><label for="ln">Password</label><input type="password" value.bind="password & validate" class="form-control" id="ln"></div><div class="form-group"><label for="ln">Retype password</label><input type="password" value.bind="password_confirmation  & validate" class="form-control" id="ln"></div><button type="submit" class="btn btn-default">Signup <i if.bind="auth.config.client.client.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form><br><p class="text-center text-muted">Already have account? <a click.delegate="chat.show(\'login\')" href="#">Log in</a></p></div></template>'})}(),System.register("partials/signup.js",["aurelia-framework","aurelia-authentication","fetch","aurelia-validation","../bootstrap-form-renderer"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.AuthService},function(a){},function(a){i=a.ValidationControllerFactory,j=a.ValidationController,k=a.ValidationRules},function(a){l=a.BootstrapFormRenderer}],execute:function(){a("Signup",(m=f(h,i),q=m((o=function(){function a(b,e){d(this,a),c(this,"chat",p,this),this.controller=null,this.name="",this.email="",this.password="",this.password_confirmation="",this.auth=b,this.controller=e.createForCurrentScope(),this.controller.addRenderer(new l)}return a.prototype.submit=function(){var a=this;this.controller.validate().then(function(b){0===b.length&&a.signup()})},a.prototype.signup=function(){var a=this;return this.auth.signup({user:{name:this.name,email:this.email,password:this.password,password_confirmation:this.password_confirmation}}).then(function(b){a.chat.router.confirmAccount=!0,a.chat.router.signup=!1,a.clearForm()}).catch(function(b){b.json().then(function(b){var c=b.errors;Object.keys(c).map(function(b){a.controller.addError(c[b],a,b)})})})},a.prototype.clearForm=function(){name="",email="",password="",password_confirmation=""},a}(),p=e(o.prototype,"chat",[g],{enumerable:!0,initializer:null}),n=o))||n)),a("Signup",q)}}}),function(){var a=System.amdDefine;a("partials/user-profile.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="overlay-title"><a class="close" click.delegate="chat.hideAll()">&times;</a><h5>${user.name} profile</h5></div><div class="overlay-content"><img src="${user.avatar}"><a href="#">${user.name}</a><form role="form" submit.delegate="submit()"><div class="form-group"><label for="fn">Name</label><input type="text" value.bind="user.name & validate" class="form-control" id="fn"></div><button type="submit" class="btn btn-default">Send <i if.bind="http.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form></div></template>'})}(),System.register("services/user-service.js",["aurelia-framework","aurelia-event-aggregator","aurelia-authentication"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.inject,e=a.singleton},function(a){f=a.EventAggregator},function(a){g=a.AuthService}],execute:function(){a("UserService",(h=d(g,f),j=h(i=function(){function a(b,d){var e=this;c(this,a),this.id=null,this.name=null,this.avatar=null,this.auth=b,this.ea=d,this.reload(),this.ea.subscribe("authentication-change",function(a){a?e.reload():e.clearData()})}return a.prototype.reload=function(){var a=this;this.auth.getMe().then(function(b){a.id=b.id,a.name=b.name,a.avatar=b.avatar})},a.prototype.setData=function(a){this.id=a.id,this.name=a.name,this.avatar=a.avatar},a.prototype.clearData=function(){this.id=null,this.name=null,this.avatar=null},a}())||i)),a("UserService",j)}}}),System.register("bootstrap-form-renderer.js",["aurelia-validation"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[function(a){d=a.ValidationRenderer,e=a.RenderInstruction,f=a.ValidationError}],execute:function(){a("BootstrapFormRenderer",g=function(){function a(){c(this,a)}return a.prototype.render=function(a){for(var b=a.unrender,c=Array.isArray(b),d=0,b=c?b:b[Symbol.iterator]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{if(d=b.next(),d.done)break;e=d.value}for(var f=e,g=f.error,h=f.elements,i=h,j=Array.isArray(i),k=0,i=j?i:i[Symbol.iterator]();;){var l;if(j){if(k>=i.length)break;l=i[k++]}else{if(k=i.next(),k.done)break;l=k.value}var m=l;this.remove(m,g)}}for(var n=a.render,o=Array.isArray(n),p=0,n=o?n:n[Symbol.iterator]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{if(p=n.next(),p.done)break;q=p.value}var r=q,g=r.error,h=r.elements;g.message=g.message[0];for(var s=h,t=Array.isArray(s),u=0,s=t?s:s[Symbol.iterator]();;){var v;if(t){if(u>=s.length)break;v=s[u++]}else{if(u=s.next(),u.done)break;v=u.value}var w=v;this.add(w,g)}}},a.prototype.add=function(a,b){var c=a.closest(".form-group");if(c){c.classList.add("has-error");var d=document.createElement("span");d.className="help-block validation-message",d.textContent=b.message,d.id="validation-message-"+b.id,c.appendChild(d)}},a.prototype.remove=function(a,b){var c=a.closest(".form-group");if(c){var d=c.querySelector("#validation-message-"+b.id);d&&(c.removeChild(d),0===c.querySelectorAll(".help-block.validation-message").length&&c.classList.remove("has-error"))}},a}()),a("BootstrapFormRenderer",g)}}}),System.register("partials/user-profile.js",["aurelia-framework","aurelia-fetch-client","aurelia-authentication","services/user-service","aurelia-validation","../bootstrap-form-renderer"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.json},function(a){i=a.AuthService},function(a){j=a.UserService},function(a){k=a.ValidationControllerFactory,l=a.ValidationController,m=a.ValidationRules},function(a){n=a.BootstrapFormRenderer}],execute:function(){a("UserProfile",(o=f(i,k,j),s=o((q=function(){function a(b,e,f){d(this,a),c(this,"chat",r,this),this.controller=null,this.user={},this.auth=b,this.controller=e.createForCurrentScope(),this.controller.addRenderer(new n),this.userService=f}return a.prototype.attached=function(){var a=this;this.auth.getMe().then(function(b){a.user=b})},a.prototype.submit=function(){var a=this;this.controller.validate().then(function(b){0===b.length&&a.update()})},a.prototype.update=function(){var a=this;return this.auth.updateMe(this.user).then(function(b){a.userService.setData(a.user)}).catch(function(b){console.debug(b),b.json().then(function(b){var c=b.errors;Object.keys(c).map(function(b){a.controller.addError(c[b],a.user,b)})})})},a}(),r=e(q.prototype,"chat",[g],{enumerable:!0,initializer:null}),p=q))||p)),a("UserProfile",s)}}}),System.register("services/spotify-client.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[function(a){d=a.inject}],execute:function(){a("SpotifyClient",(e=d("SpotifyClient"),g=e(f=function(){function a(b){c(this,a),this.http=b}return a.prototype.search=function(a){return this.http.fetch("/search?q="+encodeURIComponent(a)+"&type=track,artist,album&limit=3").then(function(a){return a.json()})},a.prototype.artistsTopTracks=function(a){return this.http.fetch("/artists/"+a+"/top-tracks?country=SE").then(function(a){return a.json()})},a.prototype.album=function(a){return this.http.fetch("/albums/"+a).then(function(a){return a.json()})},a.prototype.albums=function(a){return this.http.fetch("/albums/?ids="+a.join(",")).then(function(a){return a.json()})},a.prototype.artistAlbums=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return this.http.fetch("/artists/"+a+"/albums?album_type=album,single&limit="+c+"&offset="+b+"&country=SE").then(function(a){return a.json()})},a}())||f)),a("SpotifyClient",g)}}}),System.register("valueconverters/date-format.js",["moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a.default}],execute:function(){a("DateFormatValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b){return d(a).format(b)},a}()),a("DateFormatValueConverter",e)}}}),System.register("valueconverters/date-from.js",["moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a.default}],execute:function(){a("DateFromValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b){return d(a).from(d(b),!0)},a}()),a("DateFromValueConverter",e)}}}),System.register("valueconverters/properties.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("FilterOnPropertiesValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b,c){return void 0===a||null===a||void 0===b||void 0===c?a:a.filter(function(a){return c=RegExp.escape(c),!(c.length>0)||b.split(",").find(function(b){return new RegExp(c,"gi").test(a[b])})})},a}()),a("FilterOnPropertiesValueConverter",d),RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}}}),System.register("valueconverters/take.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("TakeValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b){return a.slice(0,b)},a}()),a("TakeValueConverter",d)}}});