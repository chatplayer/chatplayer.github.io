"bundle";!function(){var a=System.amdDefine;a("app.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="nav-bar"></require><require from="chat"></require><div id="chat-sidebar" class="sidebar-wrapper"><div class="sidebar-page-content"><nav-bar router.bind="router"></nav-bar><div class="page-host"><router-view></router-view></div></div><chat id="chat" class="sidebar"></chat></div></template>'})}(),System.register("app.js",["aurelia-framework","aurelia-authentication","services/settings","configs/platform"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.inject},function(a){e=a.AuthenticateStep},function(a){f=a.Settings},function(a){g=a.platform}],execute:function(){a("App",(h=d(f),j=h(i=function(){function a(b){c(this,a),this.settings=b}return a.prototype.configureRouter=function(a,b){a.title="ChatPlayer",g.web&&a.addPipelineStep("authorize",e),a.map([{route:"",redirect:g.web?"weblib":"library"},{route:"login",name:"login",moduleId:"fullscreen-login",title:"Login"},{route:"library",name:"library",moduleId:g.web?"library-fake":"library",nav:!0,title:"Local music"},{route:"weblib/:artist?/:song?",name:"weblib",moduleId:"weblib",nav:!0,title:"Web music",href:"#/weblib",auth:!0}]),this.router=b},a}())||i)),a("App",j)}}}),System.register("blur-image.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b,c,d,f,g){if(!(isNaN(g)||g<1)){g|=0;var h,i=a.getContext("2d");try{h=i.getImageData(b,c,d,f)}catch(j){throw new Error("unable to access image data: "+j)}var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=h.data,L=g+g+1,M=d-1,N=f-1,O=g+1,P=O*(O+1)/2,Q=new e,R=Q;for(o=1;o<L;o++)if(R=R.next=new e,o==O)var S=R;R.next=Q;var T=null,U=null;s=r=0;var V=k[g],W=l[g];for(n=0;n<f;n++){for(B=C=D=E=t=u=v=w=0,x=O*(F=K[r]),y=O*(G=K[r+1]),z=O*(H=K[r+2]),A=O*(I=K[r+3]),t+=P*F,u+=P*G,v+=P*H,w+=P*I,R=Q,o=0;o<O;o++)R.r=F,R.g=G,R.b=H,R.a=I,R=R.next;for(o=1;o<O;o++)p=r+((M<o?M:o)<<2),t+=(R.r=F=K[p])*(J=O-o),u+=(R.g=G=K[p+1])*J,v+=(R.b=H=K[p+2])*J,w+=(R.a=I=K[p+3])*J,B+=F,C+=G,D+=H,E+=I,R=R.next;for(T=Q,U=S,m=0;m<d;m++)K[r+3]=I=w*V>>W,0!=I?(I=255/I,K[r]=(t*V>>W)*I,K[r+1]=(u*V>>W)*I,K[r+2]=(v*V>>W)*I):K[r]=K[r+1]=K[r+2]=0,t-=x,u-=y,v-=z,w-=A,x-=T.r,y-=T.g,z-=T.b,A-=T.a,p=s+((p=m+g+1)<M?p:M)<<2,B+=T.r=K[p],C+=T.g=K[p+1],D+=T.b=K[p+2],E+=T.a=K[p+3],t+=B,u+=C,v+=D,w+=E,T=T.next,x+=F=U.r,y+=G=U.g,z+=H=U.b,A+=I=U.a,B-=F,C-=G,D-=H,E-=I,U=U.next,r+=4;s+=d}for(m=0;m<d;m++){for(C=D=E=B=u=v=w=t=0,r=m<<2,x=O*(F=K[r]),y=O*(G=K[r+1]),z=O*(H=K[r+2]),A=O*(I=K[r+3]),t+=P*F,u+=P*G,v+=P*H,w+=P*I,R=Q,o=0;o<O;o++)R.r=F,R.g=G,R.b=H,R.a=I,R=R.next;for(q=d,o=1;o<=g;o++)r=q+m<<2,t+=(R.r=F=K[r])*(J=O-o),u+=(R.g=G=K[r+1])*J,v+=(R.b=H=K[r+2])*J,w+=(R.a=I=K[r+3])*J,B+=F,C+=G,D+=H,E+=I,R=R.next,o<N&&(q+=d);for(r=m,T=Q,U=S,n=0;n<f;n++)p=r<<2,K[p+3]=I=w*V>>W,I>0?(I=255/I,K[p]=(t*V>>W)*I,K[p+1]=(u*V>>W)*I,K[p+2]=(v*V>>W)*I):K[p]=K[p+1]=K[p+2]=0,t-=x,u-=y,v-=z,w-=A,x-=T.r,y-=T.g,z-=T.b,A-=T.a,p=m+((p=n+O)<N?p:N)*d<<2,t+=B+=T.r=K[p],u+=C+=T.g=K[p+1],v+=D+=T.b=K[p+2],w+=E+=T.a=K[p+3],T=T.next,x+=F=U.r,y+=G=U.g,z+=H=U.b,A+=I=U.a,B-=F,C-=G,D-=H,E-=I,U=U.next,r+=d}i.putImageData(h,b,c)}}function e(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function f(a,b){var c=a.width,e=a.height,f=a.getContext("2d");f.drawImage(b,0,0,c,e),d(a,0,0,c,e,m)}var g,h,i,j,k,l,m;return{setters:[function(a){g=a.inject}],execute:function(){a("BlurImageCustomAttribute",(h=g(Element),j=h(i=function(){function a(b){c(this,a),this.element=b}return a.prototype.valueChanged=function(a){var b=this;a.complete?f(this.element,a):a.onload=function(){return f(b.element,a)}},a}())||i)),a("BlurImageCustomAttribute",j),k=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],l=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],m=40}}}),function(){var a=System.amdDefine;a("chat.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="room"></require><require from="modules/signup"></require><require from="modules/login"></require><require from="modules/forgot"></require><compose if.bind="chat.router.faq" view="modules/faq.html" chat.bind="chat" class="chat-overlay"></compose><div if.bind="!isAuthenticated" class="${platform.web ? \'fullscreen-overlay\': \'\'}"><div if.bind="!isAuthenticated && platform.web" class="hero-login text-center"><div class="logo"><img src="imgs/logo.png"></div><h1>ChatPlayer</h1><h3>You need to log in before continuing <i style="margin-left:1rem" class="fa fa-angle-right"></i></h3></div><signup if.bind="chat.router.signup || chat.router.confirmAccount || chat.router.signupSuccess" chat.bind="chat" class="chat-overlay"></signup><login if.bind="chat.router.login" chat.bind="chat" class="chat-overlay"></login><forgot if.bind="chat.router.forgot || chat.router.forgotSent" chat.bind="chat" class="chat-overlay"></forgot></div><room chat.bind="chat"></room></template>'})}(),System.register("chat.js",["aurelia-framework","services/cable","aurelia-authentication","configs/platform"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var e,f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){e=a.inject,f=a.computedFrom},function(a){g=a.Websocket},function(a){h=a.AuthService},function(a){i=a.platform}],execute:function(){j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Chat",(k=e(g,h),l=f("auth.authenticated"),o=k((n=function(){function a(b,d){c(this,a),this.router={signup:!1,login:!1,confirmAccount:!1,signupSuccess:!1,faq:!1,forgot:!1,forgotSent:!1},this.chat=this,this.websocket=b,this.auth=d,this.platform=i,i.web&&(this.router.login=!0)}return a.prototype.show=function(a){this.hideAll(),this.router[a]=!0},a.prototype.hideAll=function(){var a=this;Object.keys(this.router).forEach(function(b){a.router[b]=!1})},j(a,[{key:"isAuthenticated",get:function(){return this.auth.authenticated}},{key:"connectionOpen",get:function(){return!this.websocket.getConsumer().connection.disconnected}}]),a}(),d(n.prototype,"isAuthenticated",[l],Object.getOwnPropertyDescriptor(n.prototype,"isAuthenticated"),n.prototype),m=n))||m)),a("Chat",o)}}}),System.register("customattributes/enter-press.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.customAttribute,e=a.inject}],execute:function(){a("EnterPress",(f=d("enter-press"),g=e(Element),i=f(h=g(h=function(){function a(b){var d=this;c(this,a),this.element=b,this.enterPressed=function(a){var b=a.which||a.keyCode;13===b&&d.value()}}return a.prototype.attached=function(){this.element.addEventListener("keypress",this.enterPressed)},a.prototype.detached=function(){this.element.removeEventListener("keypress",this.enterPressed)},a}())||h)||h)),a("EnterPress",i)}}}),System.register("customattributes/infinite-scroll.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s;return{setters:[function(a){f=a.inject,g=a.bindable,h=a.customAttribute,i=a.DOM}],execute:function(){a("InfiniteScrollCustomAttribute",(j=h("infinite-scroll"),k=f(i.Element),s=j(l=k((r=q=function(){function a(b){var e=this;d(this,a),this.isTicking=!1,c(this,"callback",n,this),c(this,"scrollBuffer",o,this),c(this,"isActive",p,this),this.onScrollChange=function(){return!!e.isActive&&(e.isTicking||window.requestAnimationFrame(function(){e.checkScrollPosition(),e.isTicking=!1}),void(e.isTicking=!0))},this.element=b}return a.prototype.attached=function(){this.element.scrollTop=this.element.scrollHeight,this.element.addEventListener(a.ScrollEventName,this.onScrollChange),this.onScrollChange()},a.prototype.detached=function(){this.element.removeEventListener(a.ScrollEventName,this.onScrollChange)},a.prototype.callbackChanged=function(a){this.callback=a},a.prototype.scrollBufferChanged=function(a){this.scrollBuffer=+a},a.prototype.isActiveChanged=function(a){this.isActive="true"===a},a.prototype.checkScrollPosition=function(){var a=this.element.scrollTop,b=this.element.scrollHeight-this.element.offsetHeight;this.callback&&0!=b&&a===b&&this.callback()},a}(),q.ScrollEventName="scroll",m=r,n=e(m.prototype,"callback",[g],{enumerable:!0,initializer:null}),o=e(m.prototype,"scrollBuffer",[g],{enumerable:!0,initializer:function(){return 10}}),p=e(m.prototype,"isActive",[g],{enumerable:!0,initializer:function(){return!0}}),l=m))||l)||l)),a("InfiniteScrollCustomAttribute",s)}}}),System.register("customattributes/open-in-browser.js",["aurelia-framework","../configs/platform"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j;return{setters:[function(a){d=a.customAttribute,e=a.inject},function(a){f=a.platform}],execute:function(){a("OpenInBrowser",(g=d("open-in-browser"),h=e(Element),j=g(i=h(i=function(){function a(b){var d=this;c(this,a),this.element=b,this.onClick=function(a){if(f.electron){var b=require("electron"),c=b.shell;c.openExternal(d.value)}else window.open(d.value,"_blank");a.preventDefault()}}return a.prototype.attached=function(){this.element.addEventListener("click",this.onClick)},a.prototype.detached=function(){this.element.removeEventListener("click",this.onClick)},a}())||i)||i)),a("OpenInBrowser",j)}}}),System.register("customattributes/popover.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){f=a.customAttribute,g=a.inject,h=a.bindable}],execute:function(){a("Popover",(i=f("popover"),j=g(Element),o=i(k=j((l=function(){function a(b){d(this,a),c(this,"title",m,this),c(this,"content",n,this),this.dynamicContent=null,this.popoverObject=null,this.element=b}return a.prototype.contentChanged=function(a,b){a&&a.name&&(this.dynamicContent=a.name)},a.prototype.attached=function(){var a=this;$(this.element).popover({title:this.title,content:this.content,trigger:"manual",html:!0}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)}).on("shown.bs.popover",function(b){$(".popover-content")[0].innerHTML=a.dynamicContent})},a.prototype.detached=function(){$(this.element).popover("destroy")},a}(),m=e(l.prototype,"title",[h],{enumerable:!0,initializer:null}),n=e(l.prototype,"content",[h],{enumerable:!0,initializer:null}),k=l))||k)||k)),a("Popover",o)}}}),System.register("customattributes/sidebar-toggle.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o;return{setters:[function(a){f=a.customAttribute,g=a.inject,h=a.bindable}],execute:function(){a("SidebarToggle",(i=f("sidebar-toggle"),j=g(Element),o=i(k=j((l=function(){function a(b){var e=this;d(this,a),c(this,"target",m,this),c(this,"opened",n,this),this.element=b,this.toggleClass=function(a){e.sidebarWrapperElement.classList.toggle("opened"),a.preventDefault()}}return a.prototype.attached=function(){this.sidebarWrapperElement=document.getElementById(this.target),1==this.opened?this.sidebarWrapperElement.classList.add("opened"):this.sidebarWrapperElement.classList.remove("opened"),this.element.addEventListener("click",this.toggleClass)},a.prototype.detached=function(){this.element.removeEventListener("click",this.toggleClass)},a}(),m=e(l.prototype,"target",[h],{enumerable:!0,initializer:null}),n=e(l.prototype,"opened",[h],{enumerable:!0,initializer:null}),k=l))||k)||k)),a("SidebarToggle",o)}}}),System.register("customattributes/yt-player.js",["aurelia-framework","aurelia-event-aggregator"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l;return{setters:[function(a){d=a.inject,e=a.customAttribute,g=a.LogManager},function(a){f=a.EventAggregator}],execute:function(){a("YTPlayer",(h=d(Element,f),i=e("yt-player"),k=h(j=i(j=function(){function a(b,d){c(this,a),this.quality="hd720",this.height="100%",this.width="100%",this.params={enablejsapi:0,autoplay:0,showinfo:0,controls:0},this.duration=0,this.waitingInterval=!0,this.element=b,this.eventAggregator=d,this.logger=g.getLogger("yt-player"),this.getScript(),this.logger.debug("Plugin loaded")}return a.prototype.getScript=function(){if("undefined"==typeof YT||"undefined"==typeof YT.Player){window.onYouTubeIframeAPIReady=this.loadPlayer.bind(this);var a={publisher:this,data:"https://www.youtube.com/iframe_api"};this.eventAggregator.publish("ytplayer:init:getScript",a),this.logger.debug("Plugin init getScript")}else this.loadPlayer()},a.prototype.valueChanged=function(a){var b=this;this.videoId=a,1!=this.waitingInterval||this.playerAPI?this.loadAndPlayVideo():this.waitingInterval=setInterval(function(){return b.waitingForPlayerAndPlay()},1e3)},a.prototype.waitingForPlayerAndPlay=function(){this.playerAPI?(clearInterval(this.waitingInterval),this.loadAndPlayVideo(),this.logger.debug("ready...")):this.logger.debug("waiting...")},a.prototype.loadPlayer=function(){this.player=new YT.Player(this.element,{height:this.height,width:this.width,playerVars:this.params,events:{onReady:this.onPlayerReady.bind(this),onStateChange:this.onPlayerStateChange.bind(this),onError:this.onError.bind(this)}}),this.logger.debug("Player object created")},a.prototype.onPlayerReady=function(a){this.logger.debug("Player ready"),this.playerAPI=new l(this.player,this.element,this.logger),this.eventAggregator.publish("ytplayer:load:player",this.playerAPI)},a.prototype.loadAndPlayVideo=function(){this.videoId&&this.validVideoId(this.videoId)?(this.player.cueVideoById(this.videoId,this.quality),this.eventAggregator.publish("ytplayer:load:video",this.playerAPI),this.logger.debug("Loaded video: "+this.videoId),this.player.playVideo()):this.logger.error("Missing or Invalid video ID: "+this.videoId)},a.prototype.onPlayerStateChange=function(a){switch(a.data){case YT.PlayerState.CUED:this.eventAggregator.publish("ytplayer:state:cued",this.playerAPI);break;case YT.PlayerState.ENDED:this.eventAggregator.publish("ytplayer:state:ended",this.playerAPI);break;case YT.PlayerState.PLAYING:this.eventAggregator.publish("ytplayer:state:playing",this.playerAPI);break;case YT.PlayerState.PAUSED:this.eventAggregator.publish("ytplayer:state:paused",this.playerAPI);break;case YT.PlayerState.BUFFERING:this.eventAggregator.publish("ytplayer:state:buffering",this.playerAPI);break;default:this.eventAggregator.publish("ytplayer:state:unstarted",this.playerAPI)}},a.prototype.onError=function(a){switch(a.data){case 2:this.eventAggregator.publish("ytplayer:error:invalid-param",this.playerAPI);break;case 5:this.eventAggregator.publish("ytplayer:error:html5",this.playerAPI);break;case 100:this.eventAggregator.publish("ytplayer:error:not-found",this.playerAPI);break;case 101:case 150:this.eventAggregator.publish("ytplayer:error:access-denied",this.playerAPI);break;default:this.eventAggregator.publish("ytplayer:error:unknown",this.playerAPI)}this.eventAggregator.publish("ytplayer:error",this.playerAPI),this.logger.error("YT error: "+a.data)},a.prototype.validVideoId=function(a){return 11===a.length},a}())||j)||j)),a("YTPlayer",k),l=function(){function a(b,d,e){c(this,a),this.YtPlayerAPI=!0,this.player=b,this.element=d,this.logger=e}return a.prototype.play=function(){this.player.playVideo?this.player.playVideo():this.logger.warn("Unable to play video")},a.prototype.pause=function(){this.player.pauseVideo?this.player.pauseVideo():this.logger.warn("Unable to pause video")},a.prototype.stop=function(){this.player.stopVideo?this.player.stopVideo():this.logger.warn("Unable to stop video")},a.prototype.setSeekBar=function(a){this.player.playVideo||this.player.pauseVideo?this.player.seekTo(a):this.logger.warn("Unable to play video")},a.prototype.setVolume=function(a){this.player.setVolume(100*a)},a.prototype.getVideoId=function(){var a=this.player.getPlaylist(),b="";return a.lenght>0&&(b=a[this.player.getPlaylistIndex()]),b},a.prototype.getCurrentTime=function(){return this.player.getCurrentTime()},a.prototype.getDuration=function(){return this.player.getDuration()},a.prototype.getContainer=function(){return this.element},a}()}}}),function(){var a=System.amdDefine;a("customelements/html5-player.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><audio><source if.bind="playSource" src.bind="playSource" type="audio/ogg"><source if.bind="playSource" src.bind="playSource" type="audio/mpeg"></audio></template>'})}(),System.register("customelements/html5-player.js",["aurelia-framework","aurelia-event-aggregator"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p;return{setters:[function(a){f=a.bindable,g=a.inject,h=a.customElement},function(a){i=a.EventAggregator}],execute:function(){a("Html5Player",(j=g(Element,i),k=h("html5-player"),o=j(l=k((m=function(){function a(b,e){var f=this;d(this,a),c(this,"source",n,this),this.element=b,this.ea=e,this.handlePlayerEnded=function(){f.ea.publish("html5player:state:ended")}}return a.prototype.attached=function(){this.html5Audio=this.element.querySelector("audio"),this.html5PlayerAPI=new p(this.html5Audio),this.ea.publish("html5player:load:player",this.html5PlayerAPI),this.html5Audio.addEventListener("ended",this.handlePlayerEnded)},a.prototype.detached=function(){this.html5Audio.removeEventListener("ended",this.handlePlayerEnded)},a.prototype.sourceChanged=function(a){this.playSource=a,this.html5Audio.load(),this.html5Audio.play()},a}(),n=e(m.prototype,"source",[f],{enumerable:!0,initializer:null}),l=m))||l)||l)),a("Html5Player",o),p=function(){function a(b){d(this,a),this.Html5PlayerAPI=!0,this.player=b}return a.prototype.play=function(){this.player.play()},a.prototype.pause=function(){this.player.pause()},a.prototype.stop=function(){this.player.pause(),this.player.currentTime=0},a.prototype.setSeekBar=function(a){this.player.currentTime=a},a.prototype.setVolume=function(a){this.player.volume=a},a.prototype.getCurrentTime=function(){return this.player.currentTime},a.prototype.getDuration=function(){return this.player.duration},a}()}}}),function(){var a=System.amdDefine;a("customelements/player-controls.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customattributes/yt-player"></require><require from="customelements/html5-player"></require><html5-player source.bind="localPath"></html5-player><div show.bind="youtubeId" class="fixed-yt-player ${chatOpened == 1 ? \'\' : \'move-right\'}"><div yt-player="${youtubeId}"></div></div><div class="player-controls"><div class="pl-controls-wrapper"><div class="pl-controls"><div class="backward" click.delegate="playPrev()"></div><div class="play-track"></div><div class="forward" click.delegate="playNext()"></div></div></div><div class="seek-bar-wrapper"><input type="range" class="seek-bar" min="0" value="0"></div><div class="volume-up"></div><div class="volume-bar-wrapper"><input type="range" min="0" max="1" step="0.05" value="1" class="volume-bar"></div></div></template>'})}(),System.register("customelements/player-controls.js",["aurelia-framework","aurelia-event-aggregator","../events/player","../events/room","../utility"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){f=a.customElement,g=a.bindable,h=a.inject,i=a.observable,k=a.LogManager},function(a){j=a.EventAggregator},function(a){l=a.PlayerPlay,m=a.PlayerNext,n=a.PlayerPrev},function(a){o=a.RoomFind},function(a){p=a.areEqual}],execute:function(){a("PlayerControls",(q=h(Element,j,k),w=q((s=function(){function a(b,e,f){var g=this;d(this,a),c(this,"currentPlayer",t,this),c(this,"chat",u,this),c(this,"chatOpened",v,this),this.youtubeId=null,this.localPath=null,this.html5player=null,this.ytPlayerApi=null,this.currentPlayer=null,this.element=b,this.ea=e,this.logger=k.getLogger("player-controls"),this.ea.subscribe("ytplayer:init:getScript",function(a){$.getScript(a.data)}),this.ea.subscribe("ytplayer:load:player",function(a){g.ytPlayerApi=a,g.currentPlayer=g.ytPlayerApi,g.logger.debug("yt player loaded"),g.logger.debug(a)}),this.ea.subscribe("html5player:load:player",function(a){g.html5Player=a,g.logger.debug("html5 player loaded")}),this.ea.subscribe("ytplayer:state:ended",function(a){g.playNext()}),this.ea.subscribe("html5player:state:ended",function(a){g.playNext()}),e.subscribe(l,function(a){g.playButton.classList.add("pause"),a.localPath?(g.currentPlayer=g.html5Player,g.localPath=a.localPath,g.youtubeId=null):a.youtubeId&&(g.currentPlayer=g.ytPlayerApi,g.youtubeId=a.youtubeId),g.ea.publish(new o(a))}),this.handlePlayerEnded=function(){g.playNext()},this.onClickPlayButton=function(){var a=g.playButton.classList.toggle("pause");a?g.currentPlayer.play():g.currentPlayer.pause()},this.onChangeSeekBar=function(){var a=g.currentPlayer.getDuration()*(g.seekBar.value/100);g.currentPlayer.setSeekBar(a)}}return a.prototype.attached=function(){var a=this;this.playButton=this.element.querySelector(".play-track"),this.seekBar=this.element.querySelector(".seek-bar"),this.volumeBar=this.element.querySelector(".volume-bar"),this.playButton.addEventListener("click",this.onClickPlayButton),this.seekBar.addEventListener("change",this.onChangeSeekBar),this.seekBar.addEventListener("mousedown",function(){a.seekBarMouseDown=!0,a.currentPlayer.pause()}),this.seekBar.addEventListener("mouseup",function(){a.seekBarMouseDown=!1,a.currentPlayer.play()}),this.volumeBar.addEventListener("change",function(){a.currentPlayer.setVolume(a.volumeBar.value)}),this.updateSeekBarInterval=setInterval(function(){return a._updateSeekBarValue()},1e3)},a.prototype.detached=function(){this.playButton.removeEventListener("click",this.onClickPlayButton),this.seekBar.removeEventListener("change",this.onChangeSeekBar),clearInterval(this.updateSeekBarInterval)},a.prototype.currentPlayerChanged=function(a,b){a&&b&&!p(a,b)&&b.stop()},a.prototype._updateSeekBarValue=function(){if(this.currentPlayer&&1!=this.seekBarMouseDown){var a=100/this.currentPlayer.getDuration()*this.currentPlayer.getCurrentTime();this.seekBar.value=a}},a.prototype.playing=function(){},a.prototype.playPrev=function(){this.ea.publish(new n(this.currentPlayer))},a.prototype.playNext=function(){this.ea.publish(new m(this.currentPlayer))},a}(),t=e(s.prototype,"currentPlayer",[i],{enumerable:!0,initializer:null}),u=e(s.prototype,"chat",[g],{enumerable:!0,initializer:null}),v=e(s.prototype,"chatOpened",[g],{enumerable:!0,initializer:null}),r=s))||r)),a("PlayerControls",w)}}}),System.register("electron.js",[],function(a,b){"use strict";return{setters:[],execute:function(){}}}),function(){var a=System.amdDefine;a("fullscreen-login.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return"<template></template>"})}(),System.register("fullscreen-login.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j;return{setters:[function(a){f=a.inject,g=a.bindable}],execute:function(){a("FullscreenLogin",(h=function b(){d(this,b),c(this,"chat",i,this)},i=e(h.prototype,"chat",[g],{enumerable:!0,initializer:null}),j=h)),a("FullscreenLogin",j)}}}),function(){var a=System.amdDefine;a("library-fake.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="subpage-content container-fluid text-center"><h1 class="text-muted">Get ChatPlayer for desktop</h1><h2 class="text-muted">Listen music from your local drive</h2><br><br><a class="btn-lg btn-primary" open-in-browser="https://chatplayer.github.io/#download" href="#">Download</a></div></template>'})}(),System.register("library-fake.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("LibraryFake",d=function b(){c(this,b)}),a("LibraryFake",d)}}}),function(){var a=System.amdDefine;a("library.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="valueconverters/properties"></require><require from="valueconverters/date-format"></require><require from="customattributes/infinite-scroll"></require><nav class="navbar navbar-default subpage-navbar"><ul class="nav navbar-nav"><li><form class="navbar-form"><span class="label label-primary">${files.length}<span if.bind="selectedFilesCount"> / ${selectedFilesCount}</span></span> <span class="btn btn-primary btn-file ${importing ? \'disabled\' : \'\'}" title="Add music from local drive"><i class="fa fa-upload ${importing ? \'fa-circle-o-notch fa-spin\' : \'\'}"></i> &nbsp; Add from local drive <input type="file" webkitdirectory multiple="multiple" change.delegate="selectedDir($event)"></span></form></li><li><a if.bind="importing" style="padding-left:0;color:#a94442" class="fa fa-remove" href="#" click.delegate="cancelImport()" title="Cancel adding"></a></li></ul><ul class="nav navbar-nav"><li><a if.bind="!importing" class="fa fa-trash-o" click.delegate="clearPlaylist()" title="Remove all from library" href="#"></a></li><li><a class="fa fa-2x fa-search" href="#"></a></li></ul><ul class="nav nav-justified"><li><form class="navbar-form"><input type="text" value.bind="searchPhrase & debounce:250" class="form-control search-input" placeholder="Search local library..." autofocus></form></li></ul></nav><div class="subpage-content container-fluid"><h1 if.bind="files.length == 0" class="text-muted text-center">No items in library</h1><div if.bind="files.length > 0" class="div-table-row head"><div class="col-xs-1">#</div><div class="col-xs-3">Track</div><div class="col-xs-3">Artist</div><div class="col-xs-3">Album</div><div class="col-xs-2"><i class="fa fa-clock-o"></i></div></div><div class="div-table absolute"><div virtual-repeat.for="file of files | filterOnProperties:\'artist,album,song\':searchPhrase" click.delegate="playPath(file)" class="div-table-row ${file._id === selectedId ? \'active\' : \'\'}"><div class="col-xs-1">${file.no}</div><div class="col-xs-3 toverflow" title="${file.song}">${file.song}</div><div class="col-xs-3 toverflow" title="${file.artist}">${file.artist}</div><div class="col-xs-3 toverflow" title="${file.album}">${file.album}</div><div class="col-xs-2">${file.dur * 1000 | dateFormat: \'m:ss\'}</div></div></div></div></template>';
})}(),System.register("library.js",["aurelia-framework","aurelia-event-aggregator","./events/player","aurelia-fetch-client","fetch","fs","node-dir","nedb-promise","musicmetadata"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return{setters:[function(a){d=a.inject,e=a.singleton},function(a){f=a.EventAggregator},function(a){g=a.PlayerPlay,h=a.PlayerNext,i=a.PlayerPrev},function(a){j=a.HttpClient},function(a){},function(a){k=a["default"]},function(a){l=a["default"]},function(a){m=a["default"]},function(a){n=a["default"]}],execute:function(){o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a("Library",(p=e(),q=d(j,l,m({filename:"library.db",autoload:!0}),f),s=p(r=q(r=function(){function a(b,d,e,f){var g=this;c(this,a),this.files=[],this.filesCount=0,this.selectedId=null,this.selectedFilesCount=null,this.importing=!1,this.importCanceled=!1,this.fspath=d,this.db=e,this.ea=f,f.subscribe(h,function(a){a.html5Player&&g.playNext()}),f.subscribe(i,function(a){a.html5Player&&g.playPrev()}),this.db.ccount().exec().then(function(a){g.filesCount=a}),this.db.cfind({}).sort({artist:1,album:1,disk:1,no:1}).exec().then(function(a){g.files=a})}return a.prototype.addMore=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,c=this.files.length;console.debug("more skip: "+c+" limit: "+b),this.db.cfind({}).sort({artist:1,album:1,disk:1,no:1}).skip(c).limit(b).exec().then(function(b){b.map(function(b){a.files.push(b)})})},a.prototype.getFilePaths=function(a){var b=this;return new Promise(function(c,d){b.fspath.paths(a,function(a,b){a&&d(a),c(b)})})},a.prototype.getFileId3=function(a){return new Promise(function(b,c){var d=k.statSync(a).size,e=k.createReadStream(a);n(e,{duration:!1,fileSize:d},function(a,d){e.destroy(),a&&c(a),b(d)})})},a.prototype.getFileCover=function(a){var b=this;return this.getFileId3(a.path).then(function(c){for(var d=0;d<b.files.length;d++)if(b.files[d]._id===a._id){c.picture.length>0&&(b.files[d].cover="data: image/"+c.picture[0].format+";base64,"+c.picture[0].data.toString("base64"));break}}),!0},a.prototype.getFileId3AndInsert=function(a){var b=this;return this.getFileId3(a).then(function(c){return b.db.update({path:a},{path:a,artist:c.artist,album:c.album,song:c.title,dur:c.duration,no:c.track.no,disk:c.disk.no},{upsert:!0})})["catch"](function(b){console.debug("error: "+b+" in "+a)})},a.prototype.selectedDir=function(a){var b=this;return!(a.target.files.length<=0)&&(1!=this.importing&&(this.importing=!0,void this.getFilePaths(a.target.files[0].path).then(function(a){return a.files.filter(function(a){return/\.(?:wav|mp3|ogg|oga|aac)$/i.test(a)})}).then(function(a){b.selectedFilesCount=a.length,Promise.map(a,function(a){if(b.importCanceled)throw"Import canceled";return b.getFileId3AndInsert(a).then(function(a){if("object"==("undefined"==typeof a?"undefined":o(a))){var c=a[1];b.files.push(c)}})},{concurrency:1}).then(function(){b.importing=!1,b.selectedFilesCount=null})["catch"](function(a){console.debug("error: "+a),b.importing=!1,b.importCanceled=!1,b.selectedFilesCount=null})})))},a.prototype.cancelImport=function(){var a=confirm("Are you sure you wish to cancel adding music to player library?");return!!a&&void(this.importCanceled=!0)},a.prototype.clearPlaylist=function(){var a=this,b=confirm("Are you sure you wish to clear player library?");return!!b&&void this.db.remove({},{multi:!0}).then(function(b){a.files.splice(0,a.files.length)})},a.prototype.playPath=function(a){this.ea.publish(new g(a)),this.selectedId=a._id},a.prototype.playNext=function(){for(var a=0;a<this.files.length;a++)if(this.files[a]._id===this.selectedId){this.selectedId=this.files[a+1]._id,this.playPath(this.files[a+1]);break}},a.prototype.playPrev=function(){for(var a=0;a<this.files.length;a++)if(this.files[a]._id===this.selectedId){this.selectedId=this.files[a-1]._id,this.playPath(this.files[a-1]);break}},a}())||r)||r)),a("Library",s)}}}),System.register("configs/auth.js",["./environment","./chat"],function(a,b){"use strict";var c,d,e,f,g,h;return{setters:[function(a){c=a.env},function(a){d=a.configChat}],execute:function(){g={baseUrl:d.host,loginUrl:"users/sign_in.json",signupUrl:"users.json",loginOnSignup:!1,loginRedirect:"",signupRedirect:""},e={providers:{google:{redirectUri:d.client,clientId:"1072345495355-ofh05sa6ui841oojmbv73lffge2d29ue.apps.googleusercontent.com"},facebook:{redirectUri:d.client,clientId:"1389790321051342"}}},f={providers:{google:{redirectUri:d.client,clientId:"1072345495355-ofh05sa6ui841oojmbv73lffge2d29ue.apps.googleusercontent.com"},facebook:{redirectUri:d.client,clientId:"1389790321051342"}}},g=Object.assign(g,"development"===c?e:f),a("configAuth",h=g),a("configAuth",h)}}}),System.register("main.js",["jquery","bootstrap-sass","configs/auth","configs/environment"],function(a,b){"use strict";function c(a){"production"!=f&&a.use.developmentLogging(),a.use.standardConfiguration().plugin("aurelia-validation").plugin("aurelia-ui-virtualization").plugin("aurelia-api",function(a){a.registerEndpoint("auth")}).plugin("aurelia-authentication",function(a){a.configure(e)}),a.use.plugin("aurelia-animator-css"),a.start().then(function(){return a.setRoot()})}var d,e,f;return a("configure",c),{setters:[function(a){d=a["default"]},function(a){},function(a){e=a.configAuth},function(a){f=a.env}],execute:function(){}}}),function(){var a=System.amdDefine;a("modules/faq.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="overlay-wrapper"><a class="close" click.delegate="chat.hideAll()" href="#">&times;</a><h2 class="text-center">Tips</h2><h4><ul><li>ChatPlayer is new project, so please invite your friends share it to others</li><li>try playing some popular artists or tracks, you will meet new people faster</li><li>be nice, listen music and socialize with people</li></ul></h4><h3 class="text-center">Good luck!</h3></div></template>'})}(),function(){var a=System.amdDefine;a("modules/forgot.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div if.bind="chat.router.forgotSent" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">All good!</h2><h4 class="text-center text-muted">Check your email</h4><p class="text-muted">We send you an email with password recovery instructions</p></div><div if.bind="chat.router.forgot" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Forgot password?</h2><p class="text-muted">Please fill form to receive email with new password</p><form role="form" submit.delegate="submit()"><div class="form-group"><label for="fn">Email</label><input type="text" value.bind="email & validate" class="form-control" id="fn" placeholder="email"></div><button type="submit" class="btn btn-default">Send <i if.bind="http.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form><br><p class="text-center text-muted">Already have account? <a click.delegate="chat.show(\'login\')" href="#">Log in</a></p></div></template>'})}(),System.register("services/api-client.js",["aurelia-framework","aurelia-fetch-client","../configs/chat"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.inject},function(a){e=a.HttpClient},function(a){f=a.configChat}],execute:function(){a("ApiClient",(g=d(e),i=g(h=function b(a){return c(this,b),a.configure(function(a){a.useStandardConfiguration().withDefaults({headers:{Accept:"application/json","Content-Type":"application/json"}}).withBaseUrl(f.host).withInterceptor({request:function(a){return console.log("Requesting "+a.method+" "+a.url),a},response:function(a){return console.log("Received "+a.status+" "+a.url),a}})})})||h)),a("ApiClient",i)}}}),System.register("modules/forgot.js",["aurelia-framework","aurelia-fetch-client","../services/api-client","aurelia-validation","../bootstrap-form-renderer"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.json},function(a){i=a.ApiClient},function(a){j=a.ValidationControllerFactory,k=a.ValidationController,l=a.ValidationRules},function(a){m=a.BootstrapFormRenderer}],execute:function(){a("Forgot",(n=f(i,j),r=n((p=function(){function a(b,e){d(this,a),c(this,"chat",q,this),this.controller=null,this.email="",this.http=b,this.controller=e.createForCurrentScope(),this.controller.addRenderer(new m)}return a.prototype.submit=function(){var a=this;this.controller.validate().then(function(b){0===b.length&&a.forgot()})},a.prototype.forgot=function(){var a=this;return this.http.fetch("users/password",{method:"post",body:h({user:{email:this.email}})}).then(function(b){a.chat.router.forgotSent=!0,a.chat.router.forgot=!1,a.email=""})["catch"](function(b){b.json().then(function(b){var c=b.errors;Object.keys(c).map(function(b){a.controller.addError(c[b],a,b)})})})},a}(),q=e(p.prototype,"chat",[g],{enumerable:!0,initializer:null}),o=p))||o)),a("Forgot",r)}}}),function(){var a=System.amdDefine;a("modules/login.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div class="login-overlay"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Log in</h2><form method="post" name="loginForm"><div class="form-group has-feedback"><input class="form-control" type="text" name="email" value.bind="email" placeholder="E-mail" required autofocus> <span class="ion-at form-control-feedback"></span></div><div class="form-group has-feedback"><input class="form-control" type="password" name="password" value.bind="password" placeholder="Password" required> <span class="ion-key form-control-feedback"></span></div><div if.bind="errors"><div repeat.for="error of errors" class="alert alert-danger text-center">${error}</div></div><button type="submit" click.delegate="login()" class="btn btn-block btn-primary">Log in with e-mail <i if.bind="auth.config.client.client.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form><br><p class="text-center"><small><a click.delegate="chat.show(\'forgot\')" href="#">Forgot your password?</a></small></p><p class="text-center text-muted">Don\'t have an account yet? <a click.delegate="chat.show(\'signup\')" href="#">Sign up</a></p><div if.bind="platform.web" class="signup-or-separator"><h3 class="text-center text-muted">- or -</h3><br></div><button if.bind="platform.web" class="btn btn-block btn-google-plus" click.delegate="authenticate(\'google\')">Log in with Google</button><br><button if.bind="platform.web" class="btn btn-block btn-facebook" click.delegate="authenticate(\'facebook\')">Log in with Facebook</button></div></template>'})}(),System.register("modules/login.js",["aurelia-authentication","aurelia-framework","aurelia-router","../configs/platform","fetch"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q;return{setters:[function(a){f=a.AuthService},function(a){g=a.observable,h=a.inject,i=a.bindable},function(a){j=a.Router},function(a){k=a.platform},function(a){}],execute:function(){l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Login",(m=h(f,j,k),q=m((o=function(){function a(b,e,f){d(this,a),c(this,"chat",p,this),this.email="",this.password="",this.errors=[],this.auth=b,this.router=e,this.platform=f}return a.prototype.login=function(){var a=this;this.auth.login({user:{email:this.email,password:this.password}}).then(function(b){a.clearErrors(),a.password="",a.platform.web&&a.router.navigate("/")})["catch"](function(b){b.json().then(function(b){a.addError(b.error)})})},a.prototype.addError=function(a){this.errors=[],this.errors.push(a)},a.prototype.clearErrors=function(){this.errors=[]},a.prototype.authenticate=function(a){var b=this;return this.auth.authenticate(a).then(function(a){b.clearErrors(),b.platform.web&&b.router.navigate("/")})["catch"](function(a){a.json().then(function(a){b.addError(a.error)})})},l(a,[{key:"isAuthenticated",get:function(){return this.auth.isAuthenticated()}}]),a}(),p=e(o.prototype,"chat",[i],{enumerable:!0,initializer:null}),n=o))||n)),a("Login",q)}}}),function(){var a=System.amdDefine;a("modules/signup.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><div if.bind="chat.router.confirmAccount" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Thank you!</h2><h3 class="text-center">Confirm your account.</h3><h4 class="text-center text-muted">We sent confirmation link to your e-mail. Please confirm your account and log in.</h4><p class="text-center">Take me to <a href="#" click.delegate="chat.show(\'login\')">Log in</a> page</p></div><div if.bind="chat.router.signupSuccess" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Thank you</h2><h3 class="text-center">You\'re ready to listen and chat!</h3><h4 class="text-center">Take me to <a href="#" click.delegate="chat.show(\'login\')">Log in</a> page</h4></div><div if.bind="chat.router.signup" class="signup-overlay au-animate"><a class="close" click.delegate="chat.hideAll()">&times;</a><h2 class="text-center">Sign Up</h2><h4 class="text-center text-muted">One last step to begin your journey!</h4><form role="form" submit.delegate="submit()"><!-- <ul if.bind="controller.errors">\n        <li repeat.for="error of controller.errors">\n          ${error.message}\n        </li>\n      </ul> --><div class="form-group"><label for="fn">Name</label><input type="text" value.bind="name & validate" class="form-control" id="fn"></div><div class="form-group"><label for="fn">Email</label><input type="text" value.bind="email & validate" class="form-control" id="fn"></div><div class="form-group"><label for="ln">Password</label><input type="password" value.bind="password & validate" class="form-control" id="ln"></div><div class="form-group"><label for="ln">Retype password</label><input type="password" value.bind="password_confirmation  & validate" class="form-control" id="ln"></div><button type="submit" class="btn btn-default">Signup <i if.bind="auth.config.client.client.isRequesting" class="fa fa-circle-o-notch fa-spin"></i></button></form><br><p class="text-center text-muted">Already have account? <a click.delegate="chat.show(\'login\')" href="#">Log in</a></p></div></template>'})}(),System.register("bootstrap-form-renderer.js",["aurelia-validation"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g;return{setters:[function(a){d=a.ValidationRenderer,e=a.RenderInstruction,f=a.ValidationError}],execute:function(){a("BootstrapFormRenderer",g=function(){function a(){c(this,a)}return a.prototype.render=function(a){for(var b=a.unrender,c=Array.isArray(b),d=0,b=c?b:b[Symbol.iterator]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{if(d=b.next(),d.done)break;e=d.value}for(var f=e,g=f.error,h=f.elements,i=h,j=Array.isArray(i),k=0,i=j?i:i[Symbol.iterator]();;){var l;if(j){if(k>=i.length)break;l=i[k++]}else{if(k=i.next(),k.done)break;l=k.value}var m=l;this.remove(m,g)}}for(var n=a.render,o=Array.isArray(n),p=0,n=o?n:n[Symbol.iterator]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{if(p=n.next(),p.done)break;q=p.value}var r=q,g=r.error,h=r.elements;g.message=g.message[0];for(var s=h,t=Array.isArray(s),u=0,s=t?s:s[Symbol.iterator]();;){var v;if(t){if(u>=s.length)break;v=s[u++]}else{if(u=s.next(),u.done)break;v=u.value}var w=v;this.add(w,g)}}},a.prototype.add=function(a,b){var c=a.closest(".form-group");if(c){c.classList.add("has-error");var d=document.createElement("span");d.className="help-block validation-message",d.textContent=b.message,d.id="validation-message-"+b.id,c.appendChild(d)}},a.prototype.remove=function(a,b){var c=a.closest(".form-group");if(c){var d=c.querySelector("#validation-message-"+b.id);d&&(c.removeChild(d),0===c.querySelectorAll(".help-block.validation-message").length&&c.classList.remove("has-error"))}},a}()),a("BootstrapFormRenderer",g)}}}),System.register("modules/signup.js",["aurelia-framework","aurelia-authentication","fetch","aurelia-validation","../bootstrap-form-renderer"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.AuthService},function(a){},function(a){i=a.ValidationControllerFactory,j=a.ValidationController,k=a.ValidationRules},function(a){l=a.BootstrapFormRenderer}],execute:function(){a("Signup",(m=f(h,i),q=m((o=function(){function a(b,e){d(this,a),c(this,"chat",p,this),this.controller=null,this.name="",this.email="",this.password="",this.password_confirmation="",this.auth=b,this.controller=e.createForCurrentScope(),this.controller.addRenderer(new l)}return a.prototype.submit=function(){var a=this;this.controller.validate().then(function(b){0===b.length&&a.signup()})},a.prototype.signup=function(){var a=this;return this.auth.signup({user:{name:this.name,email:this.email,password:this.password,password_confirmation:this.password_confirmation}}).then(function(b){a.chat.router.confirmAccount=!0,a.chat.router.signup=!1,a.clearForm()})["catch"](function(b){b.json().then(function(b){var c=b.errors;Object.keys(c).map(function(b){a.controller.addError(c[b],a,b)})})})},a.prototype.clearForm=function(){name="",email="",password="",password_confirmation=""},a}(),p=e(o.prototype,"chat",[g],{enumerable:!0,initializer:null}),n=o))||n)),a("Signup",q)}}}),function(){var a=System.amdDefine;a("nav-bar.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customelements/player-controls"></require><require from="customattributes/sidebar-toggle"></require><nav class="controls-bar" role="navigation"><ul class="nav navbar-nav"><li repeat.for="row of router.navigation" class="${row.isActive ? \'active\' : \'\'}"><a if.bind="row.href != \'#/weblib\'" href.bind="row.href" title="Local music" class="fa fa-2x fa-hdd-o"></a> <a if.bind="row.href == \'#/weblib\'" href.bind="row.href" title="Web music" class="fa fa-2x fa-globe"></a></li></ul><ul class="nav navbar-nav navbar-right"><li><a title="Toggle chat" href="#" class="fa fa-comments-o fa-2x" sidebar-toggle="target: chat-sidebar; opened.bind: chatOpened;" click.delegate="chatOpenedToggle()"></a></li><!-- <li class="loader" style="width:20px;padding:20px">\n        <i if.bind="router.isNavigating || websocket" class="fa fa-circle-o-notch fa-spin fa-2x"></i>\n      </li> --></ul><ul class="nav nav-justified"><li><player-controls chat-opened.bind="chatOpened"></player-controls></li></ul></nav></template>'})}(),System.register("nav-bar.js",["aurelia-framework","services/settings"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m;return{setters:[function(a){f=a.inject,g=a.bindable},function(a){h=a.Settings}],execute:function(){a("NavBar",(i=f(h),m=i((k=function(){function a(b){var e=this;d(this,a),c(this,"router",l,this),this.chatOpened=1,this.settings=b,this.settings.find("chat-sidebar").then(function(a){void 0!==a&&(e.chatOpened=a)})}return a.prototype.chatOpenedToggle=function(){this.chatOpened=1==this.chatOpened?0:1,this.settings.save("chat-sidebar",this.chatOpened)},a}(),l=e(k.prototype,"router",[g],{enumerable:!0,initializer:null}),j=k))||j)),a("NavBar",m)}}}),function(){var a=System.amdDefine;a("room.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="customattributes/enter-press"></require><require from="customattributes/open-in-browser"></require><require from="valueconverters/date-from-now"></require><require from="valueconverters/take"></require><div class="room-wrapper"><!-- room not choosen yet --><div if.bind="!room && wsIsOpen" class="valign-wrapper"><div class="valign text-center"><div if.bind="isAuthenticated" class="text-muted"><p>You\'re logged in as</p><a href="#" class="user-label large"><img src="${userData.avatar}"></a><h4 class="text-muted">${userData.name}</h4></div><h2 class="text-muted fa fa-3x fa-arrow-circle-left"></h2><h3 class="text-muted">Search your favorite music and start chatting</h3></div></div><div class="room-overlay ${(!wsIsOpen || rateLimitReset) ? \'active\':\'\'}"><div class="valign-wrapper"><div if.bind="!wsIsOpen" class="valign text-center"><h2 class="text-muted">Connecting...</h2><i class="fa fa-circle-o-notch fa-3x fa-spin"></i></div><div if.bind="rateLimitReset" class="valign text-center"><h2 class="text-muted">Ho ho ho, to many words!</h2><i class="fa fa-chain-broken fa-3x fa-spin"></i><h3 class="text-muted">Wait a minute to send next message.</h3></div></div></div><div if.bind="room" class="room au-animate"><nav class="room-navbar"><div if.bind="currentRoom.artist && currentRoom.song" class="navbar-header"><small>${currentRoom.artist}</small><div class="navbar-title song">${currentRoom.song}</div></div><div if.bind="currentRoom.artist && !currentRoom.song" class="navbar-header"><div class="navbar-title">${currentRoom.artist}</div></div><div class="navbar-col"><ul class="nav navbar-nav"><li><a title="Toggle artist/track room" href="#" class="fa fa-exchange fa-rotate-90" click.delegate="changeRoomType()"></a></li></ul></div></nav><div class="users"><div class="users-more text-muted ${anonCount > 0 ? \'anon-count\' : \'\'}">${users.length + anonCount} ${users.length + anonCount == 1 ? \'person\' : \'people\'} <small if.bind="anonCount > 0">${anonCount} anonymous</small></div><div if.bind="users.length <= 0 && anonCount <= 0" class="users-info-text">No one visiting this room</div><div if.bind="users.length <= 0 && anonCount > 0" class="users-info-text">${anonCount} anonym. person visiting this room</div><span repeat.for="user of users | take:8" class="user-label"><span><!-- <a id="dLabel" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> --> <img src="${user.avatar}" title="${user.name}"><!-- </a> --> </span><!-- <span class="dropdown">\n            <a id="dLabel" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">\n              <img src="${user.avatar}" />\n            </a>\n            <ul class="dropdown-menu" aria-labelledby="dLabel">\n              <li><img src="${user.avatar}" /><a href="#">${user.name}</a></li>\n              <li><a href="#">some profile info</a></li>\n            </ul>\n          </span> --></span></div><div class="msgs"><div class="msgs-inner" ref="container"><h5 if.bind="(users.length + anonCount) == 1" class="text-muted text-center">Never be alone in this room again!<br><a open-in-browser="https://chatplayer.github.io/#footer" href="#">Share</a> this app to your friends</h5><div class="text-muted text-center" if.bind="msgs.length <= 0">No one said a word here. What about you?</div><div repeat.for="msg of msgs" class="msg ${grouped = msg.user.id != msgs[$index-1].user.id ? \'grouped\':null} ${lastingroup = msg.user.id != msgs[$index+1].user.id ? \'lastingroup\':\'\'}"><div class="user-label ${!grouped ? \'dis\':\'\'}"><img if.bind="grouped" class="media-object" src="${msg.user.avatar}"></div><div class="msg-body"><div class="msg-head" if.bind="grouped">${msg.user.name}</div><p>${msg.content}</p><small if.bind="lastingroup" class="created-at">${msg.created_at | dateFromNow}</small></div></div></div></div><div class="send-message"><div class="send-message-inner"><div if.bind="!isAuthenticated" class="text-center"><h4 class="text-muted">Log in right away, you can miss interesting conversation anytime!</h4><a click.delegate="chat.show(\'login\')" href="#" class="btn btn-primary">Login to write</a></div><div if.bind="isAuthenticated" class="send-row"><div class="dropup dropup-col"><a href="#" data-toggle="dropdown" title="${userData.name}" class="user-label"><img src="${userData.avatar}"> <span class="caret"></span></a><ul class="dropdown-menu" aria-labelledby="dLabel"><li if.bind="!isAuthenticated"><a href="#" click.delegate="chat.show(\'login\')">Login</a></li><li if.bind="isAuthenticated"><a href="#" click.delegate="auth.logout()">Logout</a></li></ul></div><div class="send-col"><input type="text" placeholder="Talk in ${currentRoom.song ? currentRoom.song : currentRoom.artist} room" class="form-control" value.bind="currentMsg" keyup.delegate="sendMessage($event)"></div></div></div></div></div></div></template>'})}(),System.register("events/room.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("RoomFind",d=function b(a){c(this,b),this.room=a}),a("RoomFind",d)}}}),System.register("configs/environment.js",[],function(a,b){"use strict";var c;return{setters:[],execute:function(){a("env",c="production"),a("env",c)}}}),System.register("configs/chat.js",["./environment"],function(a,b){"use strict";var c,d,e,f,g;return{setters:[function(a){c=a.env}],execute:function(){f={},d={client:"http://localhost:9000/",host:"http://localhost:3000/",wshost:"ws://localhost:3000/cable"},e={client:"https://chatplayer.github.io/app/",host:"https://chatplayer.herokuapp.com/",wshost:"wss://chatplayer.herokuapp.com/cable"},f=Object.assign(f,"development"===c?d:e),a("configChat",g=f),a("configChat",g)}}}),System.register("services/cable.js",["es6-actioncable","../configs/chat"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f;return{setters:[function(a){d=a["default"]},function(a){e=a.configChat}],execute:function(){a("Websocket",f=function(){function a(){c(this,a)}return a.prototype.connect=function(){this.consumer=d.createConsumer(e.wshost)},a.prototype.getConsumer=function(){return this.consumer||this.connect(),this.consumer},a.prototype.closeConnection=function(){this.consumer&&d.endConsumer(this.consumer),delete this.consumer},a}()),a("Websocket",f)}}}),System.register("services/settings.js",["aurelia-framework","nedb-promise"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a["default"]}],execute:function(){a("Settings",(f=d(e({filename:"settings.db",autoload:!0})),h=f(g=function(){function a(b){c(this,a),this.db=b}return a.prototype.find=function(a){return this.db.cfind({setting:a}).exec().then(function(a){return a.map(function(a){return a.value})[0]})},a.prototype.save=function(a,b){return this.db.update({setting:a},{setting:a,value:b},{upsert:!0})},a}())||g)),a("Settings",h)}}}),System.register("utility.js",[],function(a,b){"use strict";function c(a,b){return Object.keys(a).every(function(c){return b.hasOwnProperty(c)&&a[c]===b[c]})}return a("areEqual",c),{setters:[],execute:function(){}}}),System.register("room.js",["aurelia-framework","aurelia-event-aggregator","events/room","services/cable","services/settings","aurelia-authentication","./utility","fetch","moment"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){f=a.observable,g=a.inject,h=a.bindable,i=a.LogManager},function(a){j=a.EventAggregator},function(a){k=a.RoomFind},function(a){l=a.Websocket},function(a){m=a.Settings},function(a){n=a.AuthService},function(a){o=a.areEqual},function(a){},function(a){p=a["default"]}],execute:function(){q=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Room",(r=g(n,j,l,m),w=r((t=function(){function a(b,e,f,g){var h=this;d(this,a),c(this,"currentRoom",u,this),c(this,"chat",v,this),this.msgs=[],this.users=[],this.room=null,this.currentMsg=null,this.showLogin=!0,this.showSignup=!0,this.roomType=1,this.roomDataForType=null,this.rateLimitReset=!1,this.rateLimitResetCount=0,this.anonCount=0,this.roomSubscriptionsCallback={connected:function(){h.logger.debug("AC Connected: "+h.roomSubscriptions.identifier),
h.roomSubscriptions.room_data()},disconnected:function(){h.logger.debug("AC Disconnected: "+h.roomSubscriptions.identifier)},received:function(a){if(a.room_data&&(h.room=a.room_data,h.auth.authentication.getAccessToken()&&h.roomSubscriptions.login({token:h.auth.authentication.getAccessToken()})),a.user_enter){h.logger.debug("AC Receive: user_enter");var b=h.users.findIndex(function(b){return b.id==a.user_enter.id});b===-1&&h.users.push(a.user_enter)}if(a.user_leave){var c=h.users.findIndex(function(b){return b.id==a.user_leave.id});h.users.splice(c,1)}a.anons_count&&(h.anonCount=parseInt(a.anons_count)),a.list_msgs&&(h.msgs=a.list_msgs,h.scrollContainerToBottom(400)),a.list_users&&(h.logger.debug("AC Receive: list_users"),h.users=a.list_users),a.content&&(h.msgs.push(a),h.scrollContainerToBottom()),a.rate_limit_reset&&(h.rateLimitResetCount=a.rate_limit_reset,h.rateLimitReset||(h.rateLimitReset=!0,setTimeout(function(){h.rateLimitReset=!1},1e3*h.rateLimitResetCount+1e3)))},rejected:function(){h.logger.debug("AC Rejected: "+h.roomSubscriptions.identifier)},unsubscribe:function(){h.logger.debug("AC Unsubscribed: "+h.roomSubscriptions.identifier),h.roomSubscriptions=null},room_data:function(){h.logger.debug("AC Perform: room_data"),h.roomSubscriptions.perform("room_data")},login:function(a){h.logger.debug("AC Perform: login"),h.roomSubscriptions.perform("login",a)},logout:function(a){h.logger.debug("AC Perform: logout"),h.roomSubscriptions.perform("logout",a)},msg:function(a){h.logger.debug("AC Perform: msg"),h.roomSubscriptions.perform("msg",a)}},this.ea=e,this.auth=b,this.websocket=f,this.settings=g,this.logger=i.getLogger("room"),this.settings.find("room-type").then(function(a){void 0!==a&&(h.roomType=a)}),this.websocket.connect(),e.subscribe("authentication-change",function(a){h.roomSubscriptions&&(a?h.roomSubscriptions.login({token:h.auth.authentication.getToken()}):h.roomSubscriptions.logout())}),e.subscribe(k,function(a){h.roomDataForType={1:{artist:a.room.artist,song:a.room.song},2:{artist:a.room.artist,song:null}},h.currentRoom=h.roomDataForType[h.roomType]}),setInterval(function(){return h.refreshTime()},1e3)}return a.prototype.attached=function(){document.addEventListener("visibilitychange",function(){document.hidden?console.debug("hidden"):console.debug("visible")})},a.prototype.refreshTime=function(){this.currentTime=p().toJSON()},a.prototype.scrollContainerToBottom=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;setTimeout(function(){var c=a.container.offsetHeight+a.container.scrollTop;c+b>a.container.scrollHeight&&(a.container.scrollTop=a.container.scrollHeight)},50)},a.prototype.changeRoomType=function(){this.roomType=1==this.roomType?2:1,this.currentRoom=this.roomDataForType[this.roomType],this.settings.save("room-type",this.roomType)},a.prototype.currentRoomChanged=function(a,b){a&&b&&!o(a,b)?this.resubscribeToRoom(a):a&&!b&&this.resubscribeToRoom(a)},a.prototype.resubscribeToRoom=function(a){this.roomSubscriptions&&(this.websocket.getConsumer().subscriptions.remove(this.roomSubscriptions),this.roomSubscriptions.unsubscribe());var b=a;Object.assign(b,{channel:"RoomsChannel"},a),this.roomSubscriptions=this.websocket.getConsumer().subscriptions.create(b,this.roomSubscriptionsCallback)},a.prototype.sendMessage=function(a){13!=a.keyCode||this.rateLimitReset||(this.roomSubscriptions.msg({content:this.currentMsg}),this.currentMsg="")},q(a,[{key:"isAuthenticated",get:function(){return this.auth.authenticated}},{key:"wsIsOpen",get:function(){return!!this.websocket.consumer&&this.websocket.consumer.connection.isOpen()}},{key:"userData",get:function(){return this.auth.authentication.getResponseObject()}}]),a}(),u=e(t.prototype,"currentRoom",[f],{enumerable:!0,initializer:null}),v=e(t.prototype,"chat",[h],{enumerable:!0,initializer:null}),s=t))||s)),a("Room",w)}}}),function(){var a=System.amdDefine;a("user.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="blur-image"></require><section class="au-animate"><h2>${heading}</h2><div class="row au-stagger"><div class="col-sm-6 col-md-3 card-container au-animate" repeat.for="user of users"><div class="card"><canvas class="header-bg" width="250" height="70" blur-image.bind="image"></canvas><div class="avatar"><img src.bind="user.avatar_url" crossorigin ref="image"></div><div class="content"><p class="name">${user.login}</p><p><a target="_blank" class="btn btn-default" href.bind="user.html_url">Contact</a></p></div></div></div></div></section></template>'})}(),System.register("user.js",["aurelia-framework","aurelia-fetch-client","fetch"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.HttpClient},function(a){}],execute:function(){a("Users",(f=d(e),h=f(g=function(){function a(b){c(this,a),this.heading="Github Users",this.users=[],b.configure(function(a){a.useStandardConfiguration().withBaseUrl("https://api.github.com/")}),this.http=b}return a.prototype.activate=function(){var a=this;return this.http.fetch("users").then(function(a){return a.json()}).then(function(b){return a.users=b})},a}())||g)),a("Users",h)}}}),System.register("valueconverters/date-format.js",["moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a["default"]}],execute:function(){a("DateFormatValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b){return d(Math.round(a)).format(b)},a}()),a("DateFormatValueConverter",e)}}}),System.register("valueconverters/date-from-now.js",["moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a["default"]}],execute:function(){a("DateFromNowValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b){return d(a).fromNow()},a}()),a("DateFromNowValueConverter",e)}}}),System.register("valueconverters/properties.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("FilterOnPropertiesValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b,c){return void 0===a||null===a||void 0===b||void 0===c?a:a.filter(function(a){return c=RegExp.escape(c),!(c.length>0)||b.split(",").find(function(b){return new RegExp(c,"gi").test(a[b])})})},a}()),a("FilterOnPropertiesValueConverter",d),RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}}}),System.register("valueconverters/take.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("TakeValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a,b){return a.slice(0,b)},a}()),a("TakeValueConverter",d)}}}),function(){var a=System.amdDefine;a("weblib.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template><require from="blur-image"></require><require from="valueconverters/date-format"></require><nav class="navbar navbar-default subpage-navbar"><ul class="nav navbar-nav"><li><a class="fa fa-search"></a></li></ul><ul class="nav nav-justified"><li><form class="navbar-form"><input type="text" value.bind="searchPhrase & debounce:650" class="form-control search-input" placeholder="Search music on the web..." autofocus></form></li></ul><ul class="nav navbar-nav navbar-right"><li><a if.bind="spotify.http.isRequesting" class="fa fa-circle-o-notch fa-spin"></a></li></ul></nav><div class="subpage-content container-fluid"><h1 if.bind="!anySearchResults" class="text-muted text-center">No search results</h1><div if.bind="anySearchResults" class="row" style="height:100%"><div class="col-xs-3" style="height:100%"><div class="search-results"><div class="bs-callout" if.bind="searchResults.artists.items.length > 0"><h5 class="text-muted">Artists</h5><div class="media" repeat.for="artist of searchResults.artists.items" click.delegate="getArtistsAlbums(artist.id)"><div class="media-left"><img if.bind="artist.images[2][\'url\']" src.bind="artist.images[2][\'url\']" class="media-object img-responsive"> <i if.bind="!artist.images[2][\'url\']" class="fa fa-star-o media-object"></i></div><div class="media-body media-middle" title="${artist.name}">${artist.name}</div></div></div><div class="bs-callout" if.bind="searchResults.albums.items.length > 0"><h5 class="text-muted">Albums</h5><div class="media" repeat.for="album of searchResults.albums.items" click.delegate="getArtistAlbum(album.id)"><div class="media-left"><img if.bind="album.images[2][\'url\']" src.bind="album.images[2][\'url\']" class="media-object img-responsive"> <i if.bind="!album.images[2][\'url\']" class="fa fa-circle-o media-object"></i></div><div class="media-body media-middle" title="${album.name}">${album.name}</div></div></div><div class="bs-callout" if.bind="searchResults.tracks.items.length > 0"><h5 class="text-muted">Tracks</h5><div class="media" repeat.for="track of searchResults.tracks.items" click.delegate="getArtistAlbum(track.album.id)"><div class="media-left"><img if.bind="track.images[2][\'url\']" src.bind="track.images[2][\'url\']" class="media-object img-responsive"> <i if.bind="!track.images[2][\'url\']" class="fa fa-music media-object"></i></div><div class="media-body media-middle" title="${track.name}">${track.name}</div></div></div></div></div><div class="col-xs-9" style="height:100%"><div class="div-table-row head"><div class="col-xs-1">#</div><div class="col-xs-3">Track</div><div class="col-xs-3">Artist</div><div class="col-xs-3">Album</div><div class="col-xs-2"><i class="fa fa-clock-o"></i></div></div><div class="div-table absolute"><div virtual-repeat.for="item of musicResults" infinite-scroll-next="getMoreFromArtist" click.delegate="searchOnYTAndPlay(item)" class="div-table-row ${item.id === selectedId ? \'active\' : \'\'}"><div class="col-xs-1">${item.track_number}</div><div class="col-xs-3 toverflow" title="${item.name}">${item.name}</div><div class="col-xs-3 toverflow" title="${item.artists[0].name}">${item.artists[0].name}</div><div class="col-xs-3 toverflow" title="${item.album.name}">${item.album.name}</div><div class="col-xs-2">${item.duration_ms | dateFormat: \'m:ss\'}</div></div></div></div></div></div></template>'})}(),System.register("services/spotify-client.js",["aurelia-framework","aurelia-fetch-client"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.HttpClient}],execute:function(){a("SpotifyClient",(f=d(e),h=f(g=function(){function a(b){c(this,a),this.host="https://api.spotify.com/v1",this.http=b}return a.prototype.search=function(a){return this.http.fetch(this.host+"/search?q="+encodeURIComponent(a)+"&type=track,artist,album&limit=3").then(function(a){return a.json()})},a.prototype.artistsTopTracks=function(a){return this.http.fetch(this.host+"/artists/"+a+"/top-tracks?country=SE").then(function(a){return a.json()})},a.prototype.album=function(a){return this.http.fetch(this.host+"/albums/"+a).then(function(a){return a.json()})},a.prototype.albums=function(a){return this.http.fetch(this.host+"/albums/?ids="+a.join(",")).then(function(a){return a.json()})},a.prototype.artistAlbums=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return this.http.fetch(this.host+"/artists/"+a+"/albums?album_type=album,single&limit="+c+"&offset="+b+"&country=SE").then(function(a){return a.json()})},a}())||g)),a("SpotifyClient",h)}}}),System.register("configs/platform.js",[],function(a,b){"use strict";var c;return{setters:[],execute:function(){a("platform",c=window&&window.process&&"renderer"==window.process.type?{electron:!0}:{web:!0}),a("platform",c)}}}),System.register("services/googleapis-client.js",["aurelia-framework","aurelia-fetch-client","../configs/platform"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.inject},function(a){e=a.HttpClient},function(a){f=a.platform}],execute:function(){a("GoogleapisClient",(g=d(e),i=g(h=function(){function a(b){c(this,a),this.host="https://www.googleapis.com",this.http=b,f.web?this.apiKey="AIzaSyAjXHKPMS_PyhOgvmkIxFflh0umDARprXM":this.apiKey="AIzaSyAF-_zDCe3Gd9efnbF9mKzJt4S-gT7VT54"}return a.prototype.youtubeSearch=function(a){return this.http.fetch(this.host+"/youtube/v3/search?part=snippet&maxResults=10&q="+encodeURIComponent(a)+"&safeSearch=none&type=video&videoSyndicated=true&videoEmbeddable=true&videoCaption=any&videoDefinition=any&key="+this.apiKey).then(function(a){return a.json()})},a}())||h)),a("GoogleapisClient",i)}}}),System.register("events/player.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f;return{setters:[],execute:function(){a("PlayerPlay",d=function b(a){c(this,b),a.path?(this.localPath=a.path,this.artist="string"==typeof a.artist?a.artist:a.artist[0],this.album=a.album,this.song=a.song):a.youtubeId&&(this.youtubeId=a.youtubeId,this.artist=a.artists[0].name,this.album=a.album.name,this.song=a.name)}),a("PlayerPlay",d),a("PlayerNext",e=function g(a){c(this,g),a.YtPlayerAPI?this.ytPlayer=!0:a.Html5PlayerAPI&&(this.html5Player=!0)}),a("PlayerNext",e),a("PlayerPrev",f=function h(a){c(this,h),a.YtPlayerAPI?this.ytPlayer=!0:a.Html5PlayerAPI&&(this.html5Player=!0)}),a("PlayerPrev",f)}}}),System.register("weblib.js",["aurelia-framework","aurelia-event-aggregator","aurelia-fetch-client","services/spotify-client","services/googleapis-client","aurelia-router","events/player","fetch"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){f=a.inject,g=a.bindable,h=a.singleton},function(a){i=a.EventAggregator},function(a){j=a.HttpClient},function(a){k=a.SpotifyClient},function(a){l=a.GoogleapisClient},function(a){m=a.Router},function(a){n=a.PlayerPlay,o=a.PlayerNext,p=a.PlayerPrev},function(a){}],execute:function(){q=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Weblib",(r=h(),s=f(j,k,l,i,m),w=r(t=s((u=function(){function a(b,e,f,g,h){var i=this;d(this,a),c(this,"searchPhrase",v,this),this.searchResults=[],this.musicResults=[],this.musicResultsOffset=0,this.selectedId=null,this.selectedItem=null,this.selectedArtistId=null,this.youtubeResults=[],this.youtubeAttempt=0,this.urlArtistName=null,b.configure(function(a){a.useStandardConfiguration()}),this.http=b,this.spotify=e,this.googleapis=f,this.ea=g,this.router=h,g.subscribe(o,function(a){a.ytPlayer&&i.playNext()}),g.subscribe(p,function(a){a.ytPlayer&&i.playPrev()}),this.ea.subscribe("ytplayer:error",function(a){i.youtubeAttempt++,i.playInYtPlayer(i.youtubeAttempt)})}return a.prototype.activate=function(a,b){var c=this;return a.artist&&a.song?this.urlArtistName==a.artist?void this.playByName(a.song):(this.urlArtistName=a.artist,this.spotify.search(a.artist).then(function(b){c.searchResults=b,b.artists.items.length>0&&c.getArtistsAlbums(b.artists.items[0].id).then(function(){c.playByName(a.song)})})):a.artist?this.spotify.search(a.artist).then(function(a){c.searchResults=a}):void 0},a.prototype.searchPhraseChanged=function(a){var b=this;""!=a&&" "!=a&&this.spotify.search(a).then(function(a){b.searchResults=a})},a.prototype.getArtistsTopTracks=function(a){var b=this;return this.spotify.artistsTopTracks(a).then(function(a){b.musicResults=a.tracks})},a.prototype.getArtistsAlbums=function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0==c&&(this.musicResults.splice(0,this.musicResults.length),this.musicResultsOffset=c),this.spotify.artistAlbums(a,c).then(function(c){b.selectedArtistId=a;var d=c.items.map(function(a){return a.id});return 0==d.length?[]:(b.musicResultsOffset=b.musicResultsOffset+d.length,d)}).then(function(a){return b.spotify.albums(a)}).then(function(a){a.albums.map(function(a){a.tracks.items.map(function(c){c.album={name:a.name},b.musicResults.push(c)})})})},a.prototype.getMoreFromArtist=function(a,b,c){b&&this.selectedArtistId&&this.getArtistsAlbums(this.selectedArtistId,this.musicResultsOffset)},a.prototype.getArtistAlbum=function(a){var b=this;return this.spotify.album(a).then(function(a){b.musicResults=a.tracks.items,b.musicResults.map(function(b){b.album={name:a.name}})})},a.prototype.searchOnYTAndPlay=function(a){var b=this;this.selectedId=a.id,this.selectedItem=a;var c=a.artists[0].name+" "+a.name;return this.googleapis.youtubeSearch(c).then(function(c){b.youtubeResults=c.items,b.youtubeAttempt=0,b.playInYtPlayer(),b.setNewUrlAndTitle(a.artists[0].name,a.name)})},a.prototype.playInYtPlayer=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=Object.assign(this.selectedItem,{youtubeId:this.youtubeResults[a].id.videoId});this.ea.publish(new n(b))},a.prototype.playNext=function(){for(var a=0;a<this.musicResults.length;a++)if(this.musicResults[a].id===this.selectedId){this.selectedId=this.musicResults[a+1].id,this.searchOnYTAndPlay(this.musicResults[a+1]);break}},a.prototype.playPrev=function(){for(var a=0;a<this.musicResults.length;a++)if(this.musicResults[a].id===this.selectedId){this.selectedId=this.musicResults[a-1].id,this.searchOnYTAndPlay(this.musicResults[a-1]);break}},a.prototype.playByName=function(a){for(var b=0;b<this.musicResults.length;b++)if(this.musicResults[b].name==a){this.searchOnYTAndPlay(this.musicResults[b]);break}},a.prototype.setNewUrlAndTitle=function(a,b){this.router.title=a+" "+b,this.router.updateTitle(),this.router.navigateToRoute(this.router.currentInstruction.config.name,{artist:encodeURIComponent(a),song:encodeURIComponent(b)},{trigger:!1})},q(a,[{key:"anySearchResults",get:function(){return this.searchResults.artists&&(this.searchResults.artists.items.length>0||this.searchResults.albums.items.length>0||this.searchResults.tracks.items.length>0)}}]),a}(),v=e(u.prototype,"searchPhrase",[g],{enumerable:!0,initializer:null}),t=u))||t)||t)),a("Weblib",w)}}});